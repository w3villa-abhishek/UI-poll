function s3UploaderRefresh(){function e(e){var t=parseInt($("#s3_max_file_size_label").data("maxsize")),n=t/1048576;return e.size>t?(alert("File size is greater than "+n+" MB"),!1):!!e.name.match(/^[a-z0-9\u4e00-\u9fff\u2f800-\u2fa1f\uf900-\ufaff\u2b740-\u2b81f\s\-\.\(\)]+$/i)||(alert("File name includes disallowed special characters"),!1)}$("#s3-uploader").S3Uploader({remove_completed_progress_bar:!0,remove_failed_progress_bar:!0,before_add:e,progress_bar_target:$("#uploads_container")}),$("#s3-uploader").bind("s3_upload_failed",function(e,t){return alert(t.filename+" failed to upload")}),$("#s3-uploader").bind("s3_upload_complete",function(e,t){var n=$("#"+$(this).next("#destination_field").val());n.length>0&&(n.val()!=t.url&&n.val(unescape(t.url)).trigger("Edit").trigger("keyup"),n.nextAll(".s3_uploaded_image_link").attr("href",unescape(t.url)),n.nextAll(".s3_uploaded_image_link").show(),n.nextAll(".s3_direct_upload_link").html("Edit"),n.nextAll(".s3_direct_upload_link").addClass(".s3_direct_upload_change_link"),$.fancybox.close())})}function add_skill_to_my_skills(e){var t=$("#skill_capture_user_id").data("id");if(MINDSUMO_ajaxLoader.load("/skill_list/add_skill_to_user",{user_id:t,skill_name:e},"POST",null,{loadType:2,callbackFunc:function(e){e=JSON.parse(e);for(var n=e.ids,i=e.names,r=0;r<i.length;r++)skill_name=i[r],skill_id=n[r],$("#existing_skills_user_"+t).prepend("<span class='skill_capture_smallbub new_bub' data-skillid ='"+skill_id+"' data-skillname='"+skill_name+"' >"+skill_name+"<span class='skill_capture_smallbub_delete'>x</span></span>")}}),$(".skill_capture_bub").length<5){var n=$("#recommended_skills").data("rec");MINDSUMO_ajaxLoader.load("/skill_list/more_recommendation",{old_recommendation:n},"POST",$("#recommend_skills"),{})}}function initialize_skill_field_autocomplete(){$("#skill_new").autocomplete({source:function(e,t){var n=e.term.split(/,\s*/),i=n.pop(),r=$.ui.autocomplete.filter(gon.skill_list,i),o=$("#skills_list").data("skil")+","+e.term;r=$(r).not(o.split(/,\s*/)).get(),t(r.splice(0,7))},delay:30,select:function(){return is_autocomplete_on=!1,$("#skill_new").val($("#skill_new").val()+", "),!1},focus:function(e,t){var n=$("#skill_new").val();return n=n.split(","),n=n.slice(0,-1).join(),n+=""==n?"":", ",n+=t.item.value,is_autocomplete_on=!0,$("#skill_new").val(n),!1},close:function(){is_autocomplete_on=!1}}),$("#skill_new").on("keypress",function(e){if(13==e.which&&!is_autocomplete_on){var t=$("#skill_new").val();""!=t&&(continuous_text_entry+=1,add_skill_to_my_skills(t),$("#skill_new").val(""),e.preventDefault(),$("#skill_new").autocomplete(),continuous_text_entry==refresh_reco&&(continuous_text_entry=0,$(".skill_capture_bub").slice(0,14).remove(),$(".skill_capture_bub").slice(0,14).show()))}if(44==e.which){var t=$("#skill_new").val();$("#skill_new").val(t+", "),e.preventDefault()}})}function add_skill_tags_to_contest(e,t){MINDSUMO_ajaxLoader.load("/skill_list/tag_skill_to_contest",{contest_id:t,skill_name:e},"POST",null,{loadType:2,callbackFunc:function(e){e=JSON.parse(e);for(var n=e.ids,i=e.names,r=0;r<i.length;r++)skill_name=i[r],skill_id=n[r],$("#existing_skills_"+t).prepend("<span class='skill_tags_for_contests_existing new_bub' data-contestid ='"+t+"' data-skillid='"+skill_id+"' data-skillname= '"+skill_name+"'>"+skill_name+"<span class='skill_tags_for_contests_existing_delete'>x</span></span>")}})}function disableSaveSolutionButton(){$("#save_solution_button").attr("disabled","disabled"),$("#save_solution_button").css("opacity","0.3"),$("#save_solution_button").html("Saving ...")}function enableSaveSolutionButton(){$("#save_solution_button").removeAttr("disabled"),$("#save_solution_button").css("opacity","1.0"),$("#save_solution_button").html("Save Draft")}function saveSolutionAsDraft(){if(1==gon.save_draft_interval&&$("#solution_summary").length>0){var e=$("#submitted_solution").serialize();if(old_draft==e)return!1;if(old_draft=e,$("#s3_uploaded_files_div")&&$("#s3_uploaded_files_div").children().length>0&&$("#contest_solution_info_div").html("WARNING: Attached files will not be saved in draft. You will have to reattach them before submission."),0==$("#solution_summary").val().length&&supplementalSubmissionAnswerAllBlank())return!1;disableSaveSolutionButton(),MINDSUMO_ajaxLoader.load("/save_solution_draft.js",e,"POST",null,{dataType:"script"})}}function supplementalSubmissionAnswerAllBlank(){for(var e=$("#submitted_solution").serializeArray().filter(function(e){return e.name.includes("[answer]")}),t=0;t<e.length;t++)if(""!==e[t].value)return!1;return!0}function supplementalSubmissionAnswerAnyBlank(){for(var e=$("#submitted_solution").serializeArray().filter(function(e){return e.name.includes("[answer]")}),t=0;t<e.length;t++)if(""===e[t].value)return!0;return!1}function pressedSKey(e){return $.browser.chrome?19==e.which||83==e.which:115==e.which||83==e.which}function keyPressHandler(e){if((e.ctrlKey||e.metaKey&&!e.ctrlKey)&&pressedSKey(e))return saveSolutionAsDraft(),!1}function replace_file(e,t,n){$.ajax({url:"/deletesolutionfile",type:"POST",data:{solution_id:e,filename:t}}),$("#file"+n).show(),$("#replace_button"+n).hide(),$("#file_link"+n).hide()}function removeSolutionfile(e){$.ajax({url:"/deletesolutionfile",type:"POST",data:{id:e}}),$("#replace_button"+e).hide(),$("#file_link"+e).hide()}function submitSolutionOnTimeUp(){$("#submitted_solution .required_field").each(function(){var e=$(this).attr("type");if(["checkbox","radio"].includes(e)){var t=$(this).parent().parent().find("input[type="+e+"]"),n=!0;t.each(function(){this.checked&&(n=!1)}),n&&("checkbox"===e?$(this).attr("data-value","No answer").click():$(this).val("No answer").click())}else"number"===e?$(this).val()!==undefined&&""!==$(this).val()||$(this).val("0"):$(this).val()!==undefined&&""!==$(this).val()||$(this).val("No answer")}),$("#solution_summary").val("<p>Ran out of time</p>"+$("#solution_summary").val()),$("#submitted_solution").submit()}function loadConversationSnippets(e,t,n){var i=$(".load_more_conversation_snippets a");i.html("Loading..."),i.attr("disabled","true"),MINDSUMO_ajaxLoader.load("/inbox/load_conversation_snippets",{page:e,category:t},"GET",$(".inbox_list"),{loadType:n,ajaxStop:function(){i.closest(".load_more_conversation_snippets").remove(),getJsonFromUrl().other_id!=undefined&&$("#inbox_cell_"+getJsonFromUrl().other_id).click()}})}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var t=0,n=Array.prototype.slice;e.cleanData=function(t){return function(n){var i,r,o;for(o=0;null!=(r=n[o]);o++)try{i=e._data(r,"events"),i&&i.remove&&e(r).triggerHandler("remove")}catch(e){}t(n)}}(e.cleanData),e.widget=function(t,n,i){var r,o,a,s,l={},c=t.split(".")[0];return t=t.split(".")[1],r=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[c]=e[c]||{},o=e[c][t],a=e[c][t]=function(e,t){if(!this._createWidget)return new a(e,t);arguments.length&&this._createWidget(e,t)},e.extend(a,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),s=new n,s.options=e.widget.extend({},s.options),e.each(i,function(t,i){if(!e.isFunction(i))return void(l[t]=i);l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=i.apply(this,arguments),this._super=n,this._superApply=o,t}}()}),a.prototype=e.widget.extend(s,{widgetEventPrefix:o?s.widgetEventPrefix||t:t},l,{constructor:a,namespace:c,widgetName:t,widgetFullName:r}),o?(e.each(o._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,a,n._proto)}),delete o._childConstructors):n._childConstructors.push(a),e.widget.bridge(t,a),a},e.widget.extend=function(t){for(var i,r,o=n.call(arguments,1),a=0,s=o.length;a<s;a++)for(i in o[a])r=o[a][i],o[a].hasOwnProperty(i)&&r!==undefined&&(e.isPlainObject(r)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],r):e.widget.extend({},r):t[i]=r);return t},e.widget.bridge=function(t,i){var r=i.prototype.widgetFullName||t;e.fn[t]=function(o){var a="string"==typeof o,s=n.call(arguments,1),l=this;return a?this.each(function(){var n,i=e.data(this,r);return"instance"===o?(l=i,!1):i?e.isFunction(i[o])&&"_"!==o.charAt(0)?(n=i[o].apply(i,s),n!==i&&n!==undefined?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+o+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+o+"'")}):(s.length&&(o=e.widget.extend.apply(null,[o].concat(s))),this.each(function(){var t=e.data(this,r);t?(t.option(o||{}),t._init&&t._init()):e.data(this,r,new i(o,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var i,r,o,a=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(a={},i=t.split("."),t=i.shift(),i.length){for(r=a[t]=e.widget.extend({},this.options[t]),o=0;o<i.length-1;o++)r[i[o]]=r[i[o]]||{},r=r[i[o]];if(t=i.pop(),1===arguments.length)return r[t]===undefined?null:r[t];r[t]=n}else{if(1===arguments.length)return this.options[t]===undefined?null:this.options[t];a[t]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,i){var r,o=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=r=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,r=this.widget()),e.each(i,function(i,a){function s(){if(t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof a?o[a]:a).apply(o,arguments)}"string"!=typeof a&&(s.guid=a.guid=a.guid||s.guid||e.guid++);var l=i.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+o.eventNamespace,u=l[2];u?r.delegate(u,c,s):n.bind(c,s)})},_off:function(t,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(n).undelegate(n),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var r,o,a=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],o=n.originalEvent)for(r in o)r in n||(n[r]=o[r]);return this.element.trigger(n,i),!(e.isFunction(a)&&!1===a.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,r,o){"string"==typeof r&&(r={effect:r});var a,s=r?!0===r||"number"==typeof r?n:r.effect||n:t;r=r||{},"number"==typeof r&&(r={duration:r}),a=!e.isEmptyObject(r),r.complete=o,r.delay&&i.delay(r.delay),a&&e.effects&&e.effects.effect[s]?i[t](r):s!==t&&i[s]?i[s](r.duration,r.easing,o):i.queue(function(n){e(this)[t](),o&&o.call(i[0]),n()})}});e.widget}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var i,r,o,a=n.initialIframeSrc||"javascript:false;";return{send:function(s,l){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),o=/\?/.test(n.url)?"&":"?","DELETE"===n.type?(n.url=n.url+o+"_method=DELETE",n.type="POST"):"PUT"===n.type?(n.url=n.url+o+"_method=PUT",n.type="POST"):"PATCH"===n.type&&(n.url=n.url+o+"_method=PATCH",n.type="POST"),t+=1,r=e('<iframe src="'+a+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(n.paramName)?n.paramName:[n.paramName];r.unbind("load").bind("load",function(){var t;try{if(t=r.contents(),!t.length||!t[0].firstChild)throw new Error}catch(e){t=undefined}l(200,"success",{iframe:t}),e('<iframe src="'+a+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",r.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&"POST"===n.type&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",o[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,i){var r=e(t[n]);e(i).prop("name",r.prop("name")).attr("form",r.attr("form")),r.replaceWith(i)})}),i.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src",a),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var n="dragover"===t;return function(i){i.dataTransfer=i.originalEvent&&i.originalEvent.dataTransfer;var r=i.dataTransfer;r&&-1!==e.inArray("Files",r.types)&&!1!==this._trigger(t,e.Event(t,{delegatedEvent:i}))&&(i.preventDefault(),n&&(r.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||!1!==n.autoUpload&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var i,r=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=r,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).bind("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n,i=this,r=t.files[0],o=t.multipart||!e.support.xhrFileUpload,a="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),o&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),o?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:a,value:t.blob}):e.each(t.files,function(i,r){n.push({name:"array"===e.type(t.paramName)&&t.paramName[i]||a,value:r})})):(i._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(a,t.blob,r.name):e.each(t.files,function(r,o){(i._isInstanceOf("File",o)||i._isInstanceOf("Blob",o))&&n.append("array"===e.type(t.paramName)&&t.paramName[r]||a,o,o.uploadName||o.name)})),t.data=n):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(n),r-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var r=e.Deferred(),o=r.promise();return n=n||this.options.context||o,!0===t?r.resolveWith(n,i):!1===t&&r.rejectWith(n,i),o.abort=r.promise,this._enhancePromise(o)},_addConvenienceMethods:function(t,n){var i=this,r=function(t){return e.Deferred().resolveWith(i,t).promise()};n.process=function(t,o){return(t||o)&&(n._processQueue=this._processQueue=(this._processQueue||r([this])).then(function(){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():r(arguments)}).then(t,o)),this._processQueue||r([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=!1!==i._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var i,r,o=this,a=t.files[0],s=a.size,l=t.uploadedBytes,c=t.maxChunkSize||s,u=this._blobSlice,d=e.Deferred(),f=d.promise();return!(!(this._isXHRUpload(t)&&u&&(l||c<s))||t.data)&&(!!n||(l>=s?(a.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",a.error])):(r=function(){var n=e.extend({},t),f=n._progress.loaded;n.blob=u.call(a,l,l+c,a.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+s,o._initXHRData(n),o._initProgressListener(n),i=(!1!==o._trigger("chunksend",null,n)&&e.ajax(n)||o._getXHRPromise(!1,n.context)).done(function(i,a,c){l=o._getUploadedBytes(c)||l+n.chunkSize,f+n.chunkSize-n._progress.loaded&&o._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=a,n.jqXHR=c,o._trigger("chunkdone",null,n),o._trigger("chunkalways",null,n),l<s?r():d.resolveWith(n.context,[i,a,c])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,o._trigger("chunkfail",null,n),o._trigger("chunkalways",null,n),d.rejectWith(n.context,[e,t,i])})},this._enhancePromise(f),f.abort=function(){return i.abort()},r(),f)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,i,r){var o=r._progress.total,a=r._response;r._progress.loaded<o&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o,total:o}),r),a.result=r.result=t,a.textStatus=r.textStatus=n,a.jqXHR=r.jqXHR=i,this._trigger("done",null,r)},_onFail:function(e,t,n,i){var r=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),r.jqXHR=i.jqXHR=e,r.textStatus=i.textStatus=t,r.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,r,o,a,s=this,l=s._getAJAXSettings(n),c=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,i=i||((r||!1===s._trigger("send",e.Event("send",{delegatedEvent:t}),l))&&s._getXHRPromise(!1,l.context,r)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,n){s._onDone(e,t,n,l)}).fail(function(e,t,n){s._onFail(e,t,n,l)}).always(function(e,t,n){if(s._onAlways(e,t,n,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var i=s._slots.shift();i;){if("pending"===s._getDeferredState(i)){i.resolve();break}i=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),a=o.then(c)):(this._sequence=this._sequence.then(c,c),a=this._sequence),a.abort=function(){return r=[undefined,"abort","abort"],i?i.abort():(o&&o.rejectWith(l.context,r),c())},this._enhancePromise(a)):c()},_onAdd:function(t,n){var i,r,o,a,s=this,l=!0,c=e.extend({},this.options,n),u=n.files,d=u.length,f=c.limitMultiFileUploads,h=c.limitMultiFileUploadSize,p=c.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(c),v=0;if(!d)return!1;if(h&&u[0].size===undefined&&(h=undefined),(c.singleFileUploads||f||h)&&this._isXHRUpload(c))if(c.singleFileUploads||h||!f)if(!c.singleFileUploads&&h)for(o=[],i=[],a=0;a<d;a+=1)g+=u[a].size+p,(a+1===d||g+u[a+1].size+p>h||f&&a+1-v>=f)&&(o.push(u.slice(v,a+1)),r=m.slice(v,a+1),r.length||(r=m),i.push(r),v=a+1,g=0);else i=m;else for(o=[],i=[],a=0;a<d;a+=f)o.push(u.slice(a,a+f)),r=m.slice(a,a+f),r.length||(r=m),i.push(r);else o=[u],i=[m];return n.originalFiles=u,e.each(o||u,function(r,a){var c=e.extend({},n);return c.files=o?a:[a],c.paramName=i[r],s._initResponseObject(c),s._initProgressObject(c),s._addConvenienceMethods(t,c),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),c)}),l},_replaceFileInput:function(t){var n=t.fileInput,i=n.clone(!0),r=n.is(document.activeElement);t.fileInputClone=i,e("<form></form>").append(i)[0].reset(),n.after(i).detach(),r&&i.focus(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?i[0]:t}),n[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,n){var i,r=this,o=e.Deferred(),a=function(e){e&&!e.entry&&(e.entry=t),o.resolve([e])},s=function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){o.resolve(e)}).fail(a)},l=function(){i.readEntries(function(e){e.length?(c=c.concat(e),l()):s(c)},a)},c=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,o.resolve(t._file)):t.file(function(e){e.relativePath=n,o.resolve(e)},a):t.isDirectory?(i=t.createReader(),l()):o.resolve([]),o.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,i,r=t.prop("webkitEntries")||t.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(n=e.makeArray(t.prop("files")),n.length)n[0].name===undefined&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=t.prop("value")))return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,i={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(r){i.files=r,n.options.replaceFileInput&&n._replaceFileInput(i),!1!==n._trigger("change",e.Event("change",{delegatedEvent:t}),i)&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:t}),i)&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i,!1!==n._trigger("drop",e.Event("drop",{delegatedEvent:t}),r)&&n._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var i=-1!==e.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,i=this.element.data();e.each(this.element[0].attributes,function(e,r){var o,a=r.name.toLowerCase();/^data-/.test(a)&&(a=a.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),o=i[a],t._isRegExpOption(a,o)&&(o=t._getRegExp(o)),n[a]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)
}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,r=this,o=e.Deferred(),a=o.promise();return a.abort=function(){return i=!0,n?n.abort():(o.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){if(!i){if(!e.length)return void o.reject();t.files=e,n=r._onSend(null,t),n.then(function(e,t,n){o.resolve(e,t,n)},function(e,t,n){o.reject(e,t,n)})}}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";var t=function(e,n){var i=/[^\w\-\.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return n?i(n,t):function(e){return i(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,n,i,r,o){return t?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:n?"="===n?"'+_e("+i+")+'":"'+("+i+"==null?'':"+i+")+'":r?"';":o?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,function(e){return t.encMap[e]||""})},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return t}):e.tmpl=t}(this),function(){var e;e=jQuery,e.fn.S3Uploader=function(t){var n,i,r,o,a,s,l,c;return this.length>1?(this.each(function(){return e(this).S3Uploader(t)}),this):(n=this,c={path:"",additional_data:null,before_add:null,remove_completed_progress_bar:!0,remove_failed_progress_bar:!1,progress_bar_target:null,click_submit_target:null,allow_multiple_files:!0},e.extend(c,t),o=[],a=[],c.click_submit_target&&c.click_submit_target.click(function(){var e,t,n;for(t=0,n=a.length;t<n;t++)e=a[t],e.submit();return!1}),l=function(){return n.fileupload({add:function(t,i){var r;if(r=i.files[0],r.unique_id=Math.random().toString(36).substr(2,16),!c.before_add||c.before_add(r))return o.push(i),e("#template-upload").length>0?(i.context=e(e.trim(tmpl("template-upload",r))),e(i.context).appendTo(c.progress_bar_target||n)):c.allow_multiple_files||(i.context=c.progress_bar_target),c.click_submit_target?c.allow_multiple_files?a.push(i):a=[i]:i.submit()},start:function(e){return n.trigger("s3_uploads_start",[e])},progress:function(e,t){var n;if(t.context)return n=parseInt(t.loaded/t.total*100,10),t.context.find(".bar").css("width",n+"%")},done:function(t,r){var a,s;if(s=i(n,r.files[0],r.result),a=n.data("callback-url"),a&&(s[n.data("callback-param")]=s.url,e.ajax({type:n.data("callback-method"),url:a,data:s,beforeSend:function(e,t){return n.trigger("ajax:beforeSend",[e,t])},complete:function(e,t){return n.trigger("ajax:complete",[e,t])},success:function(e,t,i){return n.trigger("ajax:success",[e,t,i])},error:function(e,t,i){return n.trigger("ajax:error",[e,t,i])}})),r.context&&c.remove_completed_progress_bar&&r.context.remove(),n.trigger("s3_upload_complete",[s]),o.splice(e.inArray(r,o),1),!o.length)return n.trigger("s3_uploads_complete",[s])},fail:function(e,t){var r;return r=i(n,t.files[0],t.result),r.error_thrown=t.errorThrown,t.context&&c.remove_failed_progress_bar&&t.context.remove(),n.trigger("s3_upload_failed",[r])},formData:function(t){var i,r,o,a;return i=t.serializeArray(),r="","type"in this.files[0]&&(r=this.files[0].type),i.push({name:"content-type",value:r}),o=n.data("key").replace("{timestamp}",(new Date).getTime()).replace("{unique_id}",this.files[0].unique_id).replace("{extension}",this.files[0].name.split(".").pop()),a=e.grep(i,function(e){if("key"===e.name)return e}),a.length>0&&(a[0].value=c.path+o),"FormData"in window||n.find("input[name='key']").val(c.path+o),i}})},i=function(t,n,i){var o,a;return o={},i?(o.url=e(i).find("Location").text(),o.filepath=e("<a />").attr("href",o.url)[0].pathname):(a=t.attr("action"),o.filepath=t.find("input[name=key]").val().replace("/${filename}",""),o.url=a+o.filepath+"/"+encodeURIComponent(n.name)),o.filename=n.name,"size"in n&&(o.filesize=n.size),"lastModifiedDate"in n&&(o.lastModifiedDate=n.lastModifiedDate),"type"in n&&(o.filetype=n.type),"unique_id"in n&&(o.unique_id=n.unique_id),s(n)&&(o.relativePath=r(n)),c.additional_data&&(o=e.extend(o,c.additional_data)),o},s=function(e){return e.relativePath||e.webkitRelativePath},r=function(e){return e.relativePath||(e.webkitRelativePath?e.webkitRelativePath.split("/").slice(0,-1).join("/")+"/":void 0)},this.initialize=function(){return n.data("key",n.find("input[name='key']").val()),l(),this},this.path=function(e){return c.path=e},this.additional_data=function(e){return c.additional_data=e},this.initialize())}}.call(this),$(document).ready(function(){s3UploaderRefresh()}),function(e){"use strict";var t={i18n:{bg:{months:["\u042f\u043d\u0443\u0430\u0440\u0438","\u0424\u0435\u0432\u0440\u0443\u0430\u0440\u0438","\u041c\u0430\u0440\u0442","\u0410\u043f\u0440\u0438\u043b","\u041c\u0430\u0439","\u042e\u043d\u0438","\u042e\u043b\u0438","\u0410\u0432\u0433\u0443\u0441\u0442","\u0421\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438","\u041e\u043a\u0442\u043e\u043c\u0432\u0440\u0438","\u041d\u043e\u0435\u043c\u0432\u0440\u0438","\u0414\u0435\u043a\u0435\u043c\u0432\u0440\u0438"],dayOfWeek:["\u041d\u0434","\u041f\u043d","\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041f\u0442","\u0421\u0431"]},fa:{months:["\u0641\u0631\u0648\u0631\u062f\u06cc\u0646","\u0627\u0631\u062f\u06cc\u0628\u0647\u0634\u062a","\u062e\u0631\u062f\u0627\u062f","\u062a\u06cc\u0631","\u0645\u0631\u062f\u0627\u062f","\u0634\u0647\u0631\u06cc\u0648\u0631","\u0645\u0647\u0631","\u0622\u0628\u0627\u0646","\u0622\u0630\u0631","\u062f\u06cc","\u0628\u0647\u0645\u0646","\u0627\u0633\u0641\u0646\u062f"],dayOfWeek:["\u06cc\u06a9\u0634\u0646\u0628\u0647","\u062f\u0648\u0634\u0646\u0628\u0647","\u0633\u0647 \u0634\u0646\u0628\u0647","\u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647","\u067e\u0646\u062c\u0634\u0646\u0628\u0647","\u062c\u0645\u0639\u0647","\u0634\u0646\u0628\u0647"]},ru:{months:["\u042f\u043d\u0432\u0430\u0440\u044c","\u0424\u0435\u0432\u0440\u0430\u043b\u044c","\u041c\u0430\u0440\u0442","\u0410\u043f\u0440\u0435\u043b\u044c","\u041c\u0430\u0439","\u0418\u044e\u043d\u044c","\u0418\u044e\u043b\u044c","\u0410\u0432\u0433\u0443\u0441\u0442","\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c","\u041e\u043a\u0442\u044f\u0431\u0440\u044c","\u041d\u043e\u044f\u0431\u0440\u044c","\u0414\u0435\u043a\u0430\u0431\u0440\u044c"],dayOfWeek:["\u0412\u0441\u043a","\u041f\u043d","\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041f\u0442","\u0421\u0431"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},el:{months:["\u0399\u03b1\u03bd\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2","\u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2","\u039c\u03ac\u03c1\u03c4\u03b9\u03bf\u03c2","\u0391\u03c0\u03c1\u03af\u03bb\u03b9\u03bf\u03c2","\u039c\u03ac\u03b9\u03bf\u03c2","\u0399\u03bf\u03cd\u03bd\u03b9\u03bf\u03c2","\u0399\u03bf\u03cd\u03bb\u03b9\u03bf\u03c2","\u0391\u03cd\u03b3\u03bf\u03c5\u03c3\u03c4\u03bf\u03c2","\u03a3\u03b5\u03c0\u03c4\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2","\u039f\u03ba\u03c4\u03ce\u03b2\u03c1\u03b9\u03bf\u03c2","\u039d\u03bf\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2","\u0394\u03b5\u03ba\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2"],dayOfWeek:["\u039a\u03c5\u03c1","\u0394\u03b5\u03c5","\u03a4\u03c1\u03b9","\u03a4\u03b5\u03c4","\u03a0\u03b5\u03bc","\u03a0\u03b1\u03c1","\u03a3\u03b1\u03b2"]},de:{months:["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeek:["zo","ma","di","wo","do","vr","za"]},tr:{months:["Ocak","\u015eubat","Mart","Nisan","May\u0131s","Haziran","Temmuz","A\u011fustos","Eyl\xfcl","Ekim","Kas\u0131m","Aral\u0131k"],dayOfWeek:["Paz","Pts","Sal","\xc7ar","Per","Cum","Cts"]},fr:{months:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],dayOfWeek:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeek:["Dom","Lun","Mar","Mi\xe9","Jue","Vie","S\xe1b"]},th:{months:["\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21","\u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c","\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21","\u0e40\u0e21\u0e29\u0e32\u0e22\u0e19","\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21","\u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19","\u0e01\u0e23\u0e01\u0e0e\u0e32\u0e04\u0e21","\u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21","\u0e01\u0e31\u0e19\u0e22\u0e32\u0e22\u0e19","\u0e15\u0e38\u0e25\u0e32\u0e04\u0e21","\u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19","\u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21"],dayOfWeek:["\u0e2d\u0e32.","\u0e08.","\u0e2d.","\u0e1e.","\u0e1e\u0e24.","\u0e28.","\u0e2a."]},pl:{months:["stycze\u0144","luty","marzec","kwiecie\u0144","maj","czerwiec","lipiec","sierpie\u0144","wrzesie\u0144","pa\u017adziernik","listopad","grudzie\u0144"],dayOfWeek:["nd","pn","wt","\u015br","cz","pt","sb"]},pt:{months:["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"]},ch:{months:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],dayOfWeek:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeek:["S\xf6n","M\xe5n","Tis","Ons","Tor","Fre","L\xf6r"]},kr:{months:["1\uc6d4","2\uc6d4","3\uc6d4","4\uc6d4","5\uc6d4","6\uc6d4","7\uc6d4","8\uc6d4","9\uc6d4","10\uc6d4","11\uc6d4","12\uc6d4"],dayOfWeek:["\uc77c","\uc6d4","\ud654","\uc218","\ubaa9","\uae08","\ud1a0"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeek:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"]},da:{months:["January","Februar","Marts","April","Maj","Juni","July","August","September","Oktober","November","December"],dayOfWeek:["S\xf8n","Man","Tir","ons","Tor","Fre","l\xf8r"]},no:{months:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],dayOfWeek:["S\xf8n","Man","Tir","Ons","Tor","Fre","L\xf8r"]},ja:{months:["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],dayOfWeek:["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"]},vi:{months:["Th\xe1ng 1","Th\xe1ng 2","Th\xe1ng 3","Th\xe1ng 4","Th\xe1ng 5","Th\xe1ng 6","Th\xe1ng 7","Th\xe1ng 8","Th\xe1ng 9","Th\xe1ng 10","Th\xe1ng 11","Th\xe1ng 12"],dayOfWeek:["CN","T2","T3","T4","T5","T6","T7"]},sl:{months:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],dayOfWeek:["Ned","Pon","Tor","Sre","\u010cet","Pet","Sob"]},cs:{months:["Leden","\xdanor","B\u0159ezen","Duben","Kv\u011bten","\u010cerven","\u010cervenec","Srpen","Z\xe1\u0159\xed","\u0158\xedjen","Listopad","Prosinec"],dayOfWeek:["Ne","Po","\xdat","St","\u010ct","P\xe1","So"]},hu:{months:["Janu\xe1r","Febru\xe1r","M\xe1rcius","\xc1prilis","M\xe1jus","J\xfanius","J\xfalius","Augusztus","Szeptember","Okt\xf3ber","November","December"],dayOfWeek:["Va","H\xe9","Ke","Sze","Cs","P\xe9","Szo"]}},value:"",lang:"en",format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnWithoutClick:!0,closeOnInputClick:!0,timepicker:!0,datepicker:!0,weeks:!1,defaultTime:!1,defaultDate:!1,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,style:"",id:"",fixed:!1,roundTime:"round",className:"",weekends:[],yearOffset:0,beforeShowDay:null};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,i=this.length;n<i;n++)if(this[n]===e)return n;return-1}),Date.prototype.countDaysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()},e.fn.xdsoftScroller=function(t){return this.each(function(){var n=e(this);if(!e(this).hasClass("xdsoft_scroller_box")){var i=function(e){var t={x:0,y:0};if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var n=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t.x=n.pageX,t.y=n.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t.x=e.pageX,t.y=e.pageY);return t},r=0,o=n.children().eq(0),a=n[0].clientHeight,s=o[0].offsetHeight,l=e('<div class="xdsoft_scrollbar"></div>'),c=e('<div class="xdsoft_scroller"></div>'),u=100,d=!1;l.append(c),n.addClass("xdsoft_scroller_box").append(l),c.on("mousedown.xdsoft_scroller",function(i){a||n.trigger("resize_scroll.xdsoft_scroller",[t]);var o=i.pageY,s=parseInt(c.css("margin-top")),d=l[0].offsetHeight;e(document.body).addClass("xdsoft_noselect"),e([document.body,window]).on("mouseup.xdsoft_scroller",function t(){e([document.body,window]).off("mouseup.xdsoft_scroller",t).off("mousemove.xdsoft_scroller",r).removeClass("xdsoft_noselect")}),e(document.body).on("mousemove.xdsoft_scroller",r=function(e){var t=e.pageY-o+s;t<0&&(t=0),t+c[0].offsetHeight>d&&(t=d-c[0].offsetHeight),n.trigger("scroll_element.xdsoft_scroller",[u?t/u:0])})}),n.on("scroll_element.xdsoft_scroller",function(e,t){a||n.trigger("resize_scroll.xdsoft_scroller",[t,!0]),t=t>1?1:t<0||isNaN(t)?0:t,c.css("margin-top",u*t),o.css("marginTop",-parseInt((s-a)*t))}).on("resize_scroll.xdsoft_scroller",function(e,t,i){a=n[0].clientHeight,s=o[0].offsetHeight;var r=a/s,d=r*l[0].offsetHeight;r>1?c.hide():(c.show(),c.css("height",parseInt(d>10?d:10)),u=l[0].offsetHeight-c[0].offsetHeight,!0!==i&&n.trigger("scroll_element.xdsoft_scroller",[t||Math.abs(parseInt(o.css("marginTop")))/(s-a)]))}),n.mousewheel&&n.mousewheel(function(e,t){var i=Math.abs(parseInt(o.css("marginTop")));return n.trigger("scroll_element.xdsoft_scroller",[(i-20*t)/(s-a)]),e.stopPropagation(),!1}),n.on("touchstart",function(e){d=i(e)}),n.on("touchmove",function(e){if(d){var t=i(e),r=Math.abs(parseInt(o.css("marginTop")));n.trigger("scroll_element.xdsoft_scroller",[(r-(t.y-d.y))/(s-a)]),e.stopPropagation(),e.preventDefault(),d=i(e)}}),n.on("touchend touchcancel",function(){d=!1})}n.trigger("resize_scroll.xdsoft_scroller",[t])})},e.fn.datetimepicker=function(n){var i=48,r=57,o=96,a=105,s=17,l=46,c=13,u=27,d=8,f=37,h=38,p=39,g=40,m=9,v=116,_=65,y=67,b=86,T=90,x=89,C=!1,w=e.isPlainObject(n)||!n?e.extend(!0,{},t,n):e.extend({},t),S=0,N=function(e){e.on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function t(){e.is(":disabled")||e.is(":hidden")||!e.is(":visible")||e.data("xdsoft_datetimepicker")||(clearTimeout(S),S=setTimeout(function(){e.data("xdsoft_datetimepicker")||D(e),e.off("open.xdsoft focusin.xdsoft mousedown.xdsoft",t).trigger("open.xdsoft")},100))})},D=function(t){function n(){var e=!1;return w.startDate?e=H.strToDateTime(w.startDate):(e=w.value?w.value:t&&t.val&&t.val()?t.val():"",e=Date.parseDate(e,w.format)),e&&H.isValidDate(e)?S.data("changed",!0):e="",e||0}var S=e("<div "+(w.id?'id="'+w.id+'"':"")+" "+(w.style?'style="'+w.style+'"':"")+' class="xdsoft_datetimepicker xdsoft_noselect '+(w.weeks?" xdsoft_showweeks":"")+w.className+'"></div>'),N=e('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),D=e('<div class="xdsoft_datepicker active"></div>'),R=e('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span></div><div class="xdsoft_label xdsoft_year"><span></span></div><button type="button" class="xdsoft_next"></button></div>'),E=e('<div class="xdsoft_calendar"></div>'),k=e('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),O=k.find(".xdsoft_time_box").eq(0),A=e('<div class="xdsoft_time_variant"></div>'),P=e('<div class="xdsoft_scrollbar"></div>'),M=(e('<div class="xdsoft_scroller"></div>'),e('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>')),I=e('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>');R.find(".xdsoft_month span").after(M),R.find(".xdsoft_year span").after(I),R.find(".xdsoft_month,.xdsoft_year").on("mousedown.xdsoft",function(t){R.find(".xdsoft_select").hide();var n=e(this).find(".xdsoft_select").eq(0),i=0,r=0;H.currentTime&&(i=H.currentTime[e(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),n.show();for(var o=n.find("div.xdsoft_option"),a=0;a<o.length&&o.eq(a).data("value")!=i;a++)r+=o[0].offsetHeight;return n.xdsoftScroller(r/(n.children()[0].offsetHeight-n[0].clientHeight)),t.stopPropagation(),!1}),R.find(".xdsoft_select").xdsoftScroller().on("mousedown.xdsoft",function(e){e.stopPropagation(),e.preventDefault()}).on("mousedown.xdsoft",".xdsoft_option",function(){H&&H.currentTime&&H.currentTime[e(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"](e(this).data("value")),e(this).parent().parent().hide(),S.trigger("xchange.xdsoft"),w.onChangeMonth&&w.onChangeMonth.call&&w.onChangeMonth.call(S,H.currentTime,S.data("input"))}),S.setOptions=function(n){if(w=e.extend(!0,{},w,n),n.allowTimes&&e.isArray(n.allowTimes)&&n.allowTimes.length&&(w.allowTimes=e.extend(!0,[],n.allowTimes)),n.weekends&&e.isArray(n.weekends)&&n.weekends.length&&(w.weekends=e.extend(!0,[],n.weekends)),!w.open&&!w.opened||w.inline||t.trigger("open.xdsoft"),w.inline&&(L=!0,S.addClass("xdsoft_inline"),t.after(S).hide()),w.inverseButton&&(w.next="xdsoft_prev",w.prev="xdsoft_next"),w.datepicker?D.addClass("active"):D.removeClass("active"),w.timepicker?k.addClass("active"):k.removeClass("active"),w.value&&(t&&t.val&&t.val(w.value),H.setCurrentTime(w.value)),isNaN(w.dayOfWeekStart)||parseInt(w.dayOfWeekStart)<0||parseInt(w.dayOfWeekStart)>6?w.dayOfWeekStart=0:w.dayOfWeekStart=parseInt(w.dayOfWeekStart),w.timepickerScrollbar||P.hide(),w.minDate&&/^-(.*)$/.test(w.minDate)&&(w.minDate=H.strToDateTime(w.minDate).dateFormat(w.formatDate)),w.maxDate&&/^\+(.*)$/.test(w.maxDate)&&(w.maxDate=H.strToDateTime(w.maxDate).dateFormat(w.formatDate)),R.find(".xdsoft_today_button").css("visibility",w.todayButton?"visible":"hidden"),w.mask){var N=function(e){try{if(document.selection&&document.selection.createRange){return document.selection.createRange().getBookmark().charCodeAt(2)-2}if(e.setSelectionRange)return e.selectionStart}catch(e){return 0}},E=function(e,t){if(!(e="string"==typeof e||e instanceof String?document.getElementById(e):e))return!1;if(e.createTextRange){var n=e.createTextRange();return n.collapse(!0),n.moveEnd(t),n.moveStart(t),n.select(),!0}return!!e.setSelectionRange&&(e.setSelectionRange(t,t),!0)},O=function(e,t){var n=e.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return RegExp(n).test(t)};switch(t.off("keydown.xdsoft"),!0){case!0===w.mask:w.mask=w.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59");case"string"==e.type(w.mask):O(w.mask,t.val())||t.val(w.mask.replace(/[0-9]/g,"_")),t.on("keydown.xdsoft",function(n){var S=this.value,D=n.which;switch(!0){case D>=i&&D<=r||D>=o&&D<=a||D==d||D==l:var R=N(this),k=D!=d&&D!=l?String.fromCharCode(o<=D&&D<=a?D-i:D):"_";for(D!=d&&D!=l||!R||(R--,k="_");/[^0-9_]/.test(w.mask.substr(R,1))&&R<w.mask.length&&R>0;)R+=D==d||D==l?-1:1;if(S=S.substr(0,R)+k+S.substr(R+1),""==e.trim(S))S=w.mask.replace(/[0-9]/g,"_");else if(R==w.mask.length)break;for(R+=D==d||D==l?0:1;/[^0-9_]/.test(w.mask.substr(R,1))&&R<w.mask.length&&R>0;)R+=D==d||D==l?-1:1;O(w.mask,S)?(this.value=S,E(this,R)):""==e.trim(S)?this.value=w.mask.replace(/[0-9]/g,"_"):t.trigger("error_input.xdsoft");break;case!!~[_,y,b,T,x].indexOf(D)&&C:case!!~[u,h,g,f,p,v,s,m,c].indexOf(D):return!0}return n.preventDefault(),!1})}}w.validateOnBlur&&t.off("blur.xdsoft").on("blur.xdsoft",function(){w.allowBlank&&!e.trim(e(this).val()).length?(e(this).val(null),S.data("xdsoft_datetime").empty()):Date.parseDate(e(this).val(),w.format)?S.data("xdsoft_datetime").setCurrentTime(e(this).val()):(e(this).val(H.now().dateFormat(w.format)),S.data("xdsoft_datetime").setCurrentTime(e(this).val())),S.trigger("changedatetime.xdsoft")}),w.dayOfWeekStartPrev=0==w.dayOfWeekStart?6:w.dayOfWeekStart-1,S.trigger("xchange.xdsoft").trigger("afterOpen.xdsoft")},S.data("options",w).on("mousedown.xdsoft",function(e){return e.stopPropagation(),e.preventDefault(),I.hide(),M.hide(),!1});var F=k.find(".xdsoft_time_box");F.append(A),F.xdsoftScroller(),S.on("afterOpen.xdsoft",function(){F.xdsoftScroller()}),S.append(D).append(k),!0!==w.withoutCopyright&&S.append(N),D.append(R).append(E),e("body").append(S);var H=new function(){var e=this;e.now=function(t){var n=new Date;if(!t&&w.defaultDate){var i=e.strtodate(w.defaultDate);n.setFullYear(i.getFullYear()),n.setMonth(i.getMonth()),n.setDate(i.getDate())}if(w.yearOffset&&n.setFullYear(n.getFullYear()+w.yearOffset),!t&&w.defaultTime){var r=e.strtotime(w.defaultTime);n.setHours(r.getHours()),n.setMinutes(r.getMinutes())}return n},e.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},e.setCurrentTime=function(t){e.currentTime="string"==typeof t?e.strToDateTime(t):e.isValidDate(t)?t:e.now(),S.trigger("xchange.xdsoft")},e.empty=function(){e.currentTime=null},e.getCurrentTime=function(){return e.currentTime},e.nextMonth=function(){var t=e.currentTime.getMonth()+1;return 12==t&&(e.currentTime.setFullYear(e.currentTime.getFullYear()+1),t=0),e.currentTime.setDate(Math.min(Date.daysInMonth[t],e.currentTime.getDate())),e.currentTime.setMonth(t),w.onChangeMonth&&w.onChangeMonth.call&&w.onChangeMonth.call(S,H.currentTime,S.data("input")),S.trigger("xchange.xdsoft"),t},e.prevMonth=function(){var t=e.currentTime.getMonth()-1;return-1==t&&(e.currentTime.setFullYear(e.currentTime.getFullYear()-1),t=11),e.currentTime.setDate(Math.min(Date.daysInMonth[t],e.currentTime.getDate())),e.currentTime.setMonth(t),w.onChangeMonth&&w.onChangeMonth.call&&w.onChangeMonth.call(S,H.currentTime,S.data("input")),S.trigger("xchange.xdsoft"),t},e.strToDateTime=function(t){if(t&&t instanceof Date&&e.isValidDate(t))return t;var n,i,r=[];return(r=/^(\+|\-)(.*)$/.exec(t))&&(r[2]=Date.parseDate(r[2],w.formatDate))?(n=r[2].getTime()-6e4*r[2].getTimezoneOffset(),i=new Date(H.now().getTime()+parseInt(r[1]+"1")*n)):i=t?Date.parseDate(t,w.format):e.now(),e.isValidDate(i)||(i=e.now()),i},e.strtodate=function(t){if(t&&t instanceof Date&&e.isValidDate(t))return t;var n=t?Date.parseDate(t,w.formatDate):e.now(!0);return e.isValidDate(n)||(n=e.now(!0)),n},e.strtotime=function(t){if(t&&t instanceof Date&&e.isValidDate(t))return t;var n=t?Date.parseDate(t,w.formatTime):e.now();return e.isValidDate(n)||(n=e.now(!0)),n},e.str=function(){return e.currentTime.dateFormat(w.format)},e.currentTime=this.now()};R.find(".xdsoft_today_button").on("mousedown.xdsoft",function(){S.data("changed",!0),H.setCurrentTime(0),S.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){t.val(H.str()),S.trigger("close.xdsoft")}),R.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var t=e(this),n=0,i=!1;!function e(r){H.currentTime.getMonth();t.hasClass(w.next)?H.nextMonth():t.hasClass(w.prev)&&H.prevMonth(),w.monthChangeSpinner&&!i&&(n=setTimeout(e,r||100))}(500),e([document.body,window]).on("mouseup.xdsoft",function t(){clearTimeout(n),i=!0,e([document.body,window]).off("mouseup.xdsoft",t)})}),k.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var t=e(this),n=0,i=!1,r=110;!function e(o){var a=O[0].clientHeight,s=A[0].offsetHeight,l=Math.abs(parseInt(A.css("marginTop")));t.hasClass(w.next)&&s-a-w.timeHeightInTimePicker>=l?A.css("marginTop","-"+(l+w.timeHeightInTimePicker)+"px"):t.hasClass(w.prev)&&l-w.timeHeightInTimePicker>=0&&A.css("marginTop","-"+(l-w.timeHeightInTimePicker)+"px"),O.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(s-a))]),r=r>10?10:r-10,!i&&(n=setTimeout(e,o||r))}(500),e([document.body,window]).on("mouseup.xdsoft",function t(){clearTimeout(n),i=!0,e([document.body,window]).off("mouseup.xdsoft",t)})});var j=0;S.on("xchange.xdsoft",function(t){clearTimeout(j),j=setTimeout(function(){for(var t="",n=new Date(H.currentTime.getFullYear(),H.currentTime.getMonth(),1,12,0,0),i=0,r=H.now();n.getDay()!=w.dayOfWeekStart;)n.setDate(n.getDate()-1);t+="<table><thead><tr>",w.weeks&&(t+="<th></th>");for(var o=0;o<7;o++)t+="<th>"+w.i18n[w.lang].dayOfWeek[o+w.dayOfWeekStart>6?0:o+w.dayOfWeekStart]+"</th>";t+="</tr></thead>",t+="<tbody>";var a=!1,s=!1;!1!==w.maxDate&&(a=H.strtodate(w.maxDate),a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999)),!1!==w.minDate&&(s=H.strtodate(w.minDate),s=new Date(s.getFullYear(),s.getMonth(),s.getDate()));for(var l,c,u,d,f,h=[],p=!0;i<H.currentTime.countDaysInMonth()||n.getDay()!=w.dayOfWeekStart||H.currentTime.getMonth()==n.getMonth();)h=[],i++,l=n.getDate(),c=n.getFullYear(),u=n.getMonth(),d=n.getWeekOfYear(),h.push("xdsoft_date"),f=w.beforeShowDay&&w.beforeShowDay.call?w.beforeShowDay.call(S,n):null,(!1!==a&&n>a||!1!==s&&n<s||f&&!1===f[0])&&h.push("xdsoft_disabled"),f&&""!=f[1]&&h.push(f[1]),H.currentTime.getMonth()!=u&&h.push("xdsoft_other_month"),(w.defaultSelect||S.data("changed"))&&H.currentTime.dateFormat(w.formatDate)==n.dateFormat(w.formatDate)&&h.push("xdsoft_current"),r.dateFormat(w.formatDate)==n.dateFormat(w.formatDate)&&h.push("xdsoft_today"),(0==n.getDay()||6==n.getDay()||~w.weekends.indexOf(n.dateFormat(w.formatDate)))&&h.push("xdsoft_weekend"),w.beforeShowDay&&"function"==typeof w.beforeShowDay&&h.push(w.beforeShowDay(n)),p&&(t+="<tr>",p=!1,w.weeks&&(t+="<th>"+d+"</th>")),t+='<td data-date="'+l+'" data-month="'+u+'" data-year="'+c+'" class="xdsoft_date xdsoft_day_of_week'+n.getDay()+" "+h.join(" ")+'"><div>'+l+"</div></td>",n.getDay()==w.dayOfWeekStartPrev&&(t+="</tr>",p=!0),n.setDate(l+1);t+="</tbody></table>",E.html(t),R.find(".xdsoft_label span").eq(0).text(w.i18n[w.lang].months[H.currentTime.getMonth()]),R.find(".xdsoft_label span").eq(1).text(H.currentTime.getFullYear());var g="",m="",u="",v=function(e,t){var n=H.now();n.setHours(e),e=parseInt(n.getHours()),n.setMinutes(t),t=parseInt(n.getMinutes()),h=[],(!1!==w.maxTime&&H.strtotime(w.maxTime).getTime()<n.getTime()||!1!==w.minTime&&H.strtotime(w.minTime).getTime()>n.getTime())&&h.push("xdsoft_disabled"),(w.initTime||w.defaultSelect||S.data("changed"))&&parseInt(H.currentTime.getHours())==parseInt(e)&&(w.step>59||Math[w.roundTime](H.currentTime.getMinutes()/w.step)*w.step==parseInt(t))&&(w.defaultSelect||S.data("changed")?h.push("xdsoft_current"):w.initTime&&h.push("xdsoft_init_time")),parseInt(r.getHours())==parseInt(e)&&parseInt(r.getMinutes())==parseInt(t)&&h.push("xdsoft_today"),g+='<div class="xdsoft_time '+h.join(" ")+'" data-hour="'+e+'" data-minute="'+t+'">'+n.dateFormat(w.formatTime)+"</div>"};if(w.allowTimes&&e.isArray(w.allowTimes)&&w.allowTimes.length)for(var i=0;i<w.allowTimes.length;i++)m=H.strtotime(w.allowTimes[i]).getHours(),u=H.strtotime(w.allowTimes[i]).getMinutes(),v(m,u);else for(var i=0,o=0;i<(w.hours12?12:24);i++)for(o=0;o<60;o+=w.step)m=(i<10?"0":"")+i,u=(o<10?"0":"")+o,v(m,u);A.html(g);var _="",i=0;for(i=parseInt(w.yearStart,10)+w.yearOffset;i<=parseInt(w.yearEnd,10)+w.yearOffset;i++)_+='<div class="xdsoft_option '+(H.currentTime.getFullYear()==i?"xdsoft_current":"")+'" data-value="'+i+'">'+i+"</div>";for(I.children().eq(0).html(_),i=0,_="";i<=11;i++)_+='<div class="xdsoft_option '+(H.currentTime.getMonth()==i?"xdsoft_current":"")+'" data-value="'+i+'">'+w.i18n[w.lang].months[i]+"</div>";M.children().eq(0).html(_),e(S).trigger("generate.xdsoft")},10),t.stopPropagation()}).on("afterOpen.xdsoft",function(){if(w.timepicker){var e;if(A.find(".xdsoft_current").length?e=".xdsoft_current":A.find(".xdsoft_init_time").length&&(e=".xdsoft_init_time"),e){var t=O[0].clientHeight,n=A[0].offsetHeight,i=A.find(e).index()*w.timeHeightInTimePicker+1;n-t<i&&(i=n-t),O.trigger("scroll_element.xdsoft_scroller",[parseInt(i)/(n-t)])}else O.trigger("scroll_element.xdsoft_scroller",[0])}});var $=0;E.on("click.xdsoft","td",function(n){n.stopPropagation(),$++;var i=e(this),r=H.currentTime;if(r!==undefined&&null!==r||(H.currentTime=H.now(),r=H.currentTime),i.hasClass("xdsoft_disabled"))return!1;r.setDate(1),r.setFullYear(i.data("year")),r.setMonth(i.data("month")),r.setDate(i.data("date")),S.trigger("select.xdsoft",[r]),t.val(H.str()),($>1||!0===w.closeOnDateSelect||0===w.closeOnDateSelect&&!w.timepicker)&&!w.inline&&S.trigger("close.xdsoft"),w.onSelectDate&&w.onSelectDate.call&&w.onSelectDate.call(S,H.currentTime,S.data("input")),S.data("changed",!0),S.trigger("xchange.xdsoft"),S.trigger("changedatetime.xdsoft"),setTimeout(function(){$=0},200)}),A.on("click.xdsoft","div",function(t){t.stopPropagation();var n=e(this),i=H.currentTime;if(i!==undefined&&null!==i||(H.currentTime=H.now(),i=H.currentTime),n.hasClass("xdsoft_disabled"))return!1;i.setHours(n.data("hour")),i.setMinutes(n.data("minute")),S.trigger("select.xdsoft",[i]),S.data("input").val(H.str()),!w.inline&&S.trigger("close.xdsoft"),w.onSelectTime&&w.onSelectTime.call&&w.onSelectTime.call(S,H.currentTime,S.data("input")),S.data("changed",!0),S.trigger("xchange.xdsoft"),S.trigger("changedatetime.xdsoft")}),S.mousewheel&&D.mousewheel(function(e,t){return!w.scrollMonth||(t<0?H.nextMonth():H.prevMonth(),!1)}),S.mousewheel&&O.unmousewheel().mousewheel(function(e,t){if(!w.scrollTime)return!0;var n=O[0].clientHeight,i=A[0].offsetHeight,r=Math.abs(parseInt(A.css("marginTop"))),o=!0;return t<0&&i-n-w.timeHeightInTimePicker>=r?(A.css("marginTop","-"+(r+w.timeHeightInTimePicker)+"px"),o=!1):t>0&&r-w.timeHeightInTimePicker>=0&&(A.css("marginTop","-"+(r-w.timeHeightInTimePicker)+"px"),o=!1),O.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(A.css("marginTop"))/(i-n))]),e.stopPropagation(),o});var L=!1;S.on("changedatetime.xdsoft",function(){if(w.onChangeDateTime&&w.onChangeDateTime.call){var e=S.data("input");w.onChangeDateTime.call(S,H.currentTime,e),e.trigger("change")}}).on("generate.xdsoft",function(){w.onGenerate&&w.onGenerate.call&&w.onGenerate.call(S,H.currentTime,S.data("input")),L&&(S.trigger("afterOpen.xdsoft"),L=!1)}).on("click.xdsoft",function(e){e.stopPropagation()});var W=0;t.mousewheel&&t.mousewheel(function(e,n,i,r){return!w.scrollInput||(!w.datepicker&&w.timepicker?(W=A.find(".xdsoft_current").length?A.find(".xdsoft_current").eq(0).index():0,W+n>=0&&W+n<A.children().length&&(W+=n),A.children().eq(W).length&&A.children().eq(W).trigger("mousedown"),!1):w.datepicker&&!w.timepicker?(D.trigger(e,[n,i,r]),t.val&&t.val(H.str()),S.trigger("changedatetime.xdsoft"),!1):void 0)});var B=function(){var t=S.data("input").offset(),n=t.top+S.data("input")[0].offsetHeight-1,i=t.left,r="absolute";w.fixed?(n-=e(window).scrollTop(),i-=e(window).scrollLeft(),r="fixed"):(n+S[0].offsetHeight>e(window).height()+e(window).scrollTop()&&(n=t.top-S[0].offsetHeight+1),n<0&&(n=0),i+S[0].offsetWidth>e(window).width()&&(i=t.left-S[0].offsetWidth+S.data("input")[0].offsetWidth)),S.css({
left:i,top:n,position:r})};S.on("open.xdsoft",function(){var t=!0;w.onShow&&w.onShow.call&&(t=w.onShow.call(S,H.currentTime,S.data("input"))),!1!==t&&(S.show(),B(),e(window).off("resize.xdsoft",B).on("resize.xdsoft",B),w.closeOnWithoutClick&&e([document.body,window]).on("mousedown.xdsoft",function t(){S.trigger("close.xdsoft"),e([document.body,window]).off("mousedown.xdsoft",t)}))}).on("close.xdsoft",function(e){var t=!0;w.onClose&&w.onClose.call&&(t=w.onClose.call(S,H.currentTime,S.data("input"))),!1===t||w.opened||w.inline||S.hide(),e.stopPropagation()}).data("input",t);var z=0;S.data("xdsoft_datetime",H),S.setOptions(w),H.setCurrentTime(n()),t.data("xdsoft_datetimepicker",S).on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function(){t.is(":disabled")||t.is(":hidden")||!t.is(":visible")||t.data("xdsoft_datetimepicker").is(":visible")&&w.closeOnInputClick||(clearTimeout(z),z=setTimeout(function(){t.is(":disabled")||t.is(":hidden")||!t.is(":visible")||(L=!0,H.setCurrentTime(n()),S.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(t){var n=(this.value,t.which);switch(!0){case!!~[c].indexOf(n):var i=e("input:visible,textarea:visible");return S.trigger("close.xdsoft"),i.eq(i.index(this)+1).focus(),!1;case!!~[m].indexOf(n):return S.trigger("close.xdsoft"),!0}})},R=function(t){var n=t.data("xdsoft_datetimepicker");n&&(n.data("xdsoft_datetime",null),n.remove(),t.data("xdsoft_datetimepicker",null).off("open.xdsoft focusin.xdsoft focusout.xdsoft mousedown.xdsoft blur.xdsoft keydown.xdsoft"),e(window).off("resize.xdsoft"),e([window,document.body]).off("mousedown.xdsoft"),t.unmousewheel&&t.unmousewheel())};return e(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(e){e.keyCode==s&&(C=!0)}).on("keyup.xdsoftctrl",function(e){e.keyCode==s&&(C=!1)}),this.each(function(){var t;if(t=e(this).data("xdsoft_datetimepicker")){if("string"===e.type(n))switch(n){case"show":e(this).select().focus(),t.trigger("open.xdsoft");break;case"hide":t.trigger("close.xdsoft");break;case"destroy":R(e(this));break;case"reset":this.value=this.defaultValue,this.value&&t.data("xdsoft_datetime").isValidDate(Date.parseDate(this.value,w.format))||t.data("changed",!1),t.data("xdsoft_datetime").setCurrentTime(this.value)}else t.setOptions(n);return 0}"string"!==e.type(n)&&(!w.lazyInit||w.open||w.inline?D(e(this)):N(e(this)))})},e.fn.datetimepicker.defaults=t}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var r,o=t||window.event,a=[].slice.call(arguments,1),s=0,l=0,c=0,u=0,d=0;return t=e.event.fix(o),t.type="mousewheel",o.wheelDelta&&(s=o.wheelDelta),o.detail&&(s=-1*o.detail),o.deltaY&&(c=-1*o.deltaY,s=c),o.deltaX&&(l=o.deltaX,s=-1*l),o.wheelDeltaY!==undefined&&(c=o.wheelDeltaY),o.wheelDeltaX!==undefined&&(l=-1*o.wheelDeltaX),u=Math.abs(s),(!n||u<n)&&(n=u),d=Math.max(Math.abs(c),Math.abs(l)),(!i||d<i)&&(i=d),r=s>0?"floor":"ceil",s=Math[r](s/n),l=Math[r](l/i),c=Math[r](c/i),a.unshift(t,s,l,c),(e.event.dispatch||e.event.handle).apply(this,a)}var n,i,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(e.event.fixHooks)for(var a=r.length;a;)e.event.fixHooks[r[--a]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=o.length;e;)this.addEventListener(o[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=o.length;e;)this.removeEventListener(o[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(e){return"unixtime"==e?parseInt(this.getTime()/1e3):(null==Date.formatFunctions[e]&&Date.createNewFormat(e),this[Date.formatFunctions[e]]())},Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;for(var code="Date.prototype."+funcName+" = function() {return ",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,code+="'"+String.escape(ch)+"' + "):code+=Date.getFormatCode(ch):special=!0;eval(code.substring(0,code.length-3)+";}")},Date.getFormatCode=function(e){switch(e){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(e)+"' + "}},Date.parseDate=function(e,t){if("unixtime"==t)return new Date(isNaN(parseInt(e))?0:1e3*parseInt(e));null==Date.parseFunctions[t]&&Date.createParser(t);var n=Date.parseFunctions[t];return Date[n](e)},Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++,regexNum=Date.parseRegexes.length,currentGroup=1;Date.parseFunctions[format]=funcName;for(var code="Date."+funcName+" = function(input) {\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1, z = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {",regex="",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,regex+=String.escape(ch)):(obj=Date.formatCodeToRegex(ch,currentGroup),currentGroup+=obj.g,regex+=obj.s,obj.g&&obj.c&&(code+=obj.c)):special=!0;code+="if (y > 0 && z > 0){\nvar doyDate = new Date(y,0);\ndoyDate.setDate(z);\nm = doyDate.getMonth();\nd = doyDate.getDate();\n}",code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$"),eval(code)},Date.formatCodeToRegex=function(e,t){switch(e){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:1,c:"z = parseInt(results["+t+"], 10);\n",s:"(\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+t+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+t+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+t+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+t+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+t+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(e)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+String.leftPad(Math.abs(this.getTimezoneOffset())%60,2,"0")},Date.prototype.getDayOfYear=function(){var e=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var t=0;t<this.getMonth();++t)e+=Date.daysInMonth[t];return e+this.getDate()},Date.prototype.getWeekOfYear=function(){var e=this.getDayOfYear()+(4-this.getDay()),t=new Date(this.getFullYear(),0,1),n=7-t.getDay()+4;return String.leftPad(Math.ceil((e-n)/7)+1,2,"0")},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return 0==(3&e)&&(e%100||e%400==0&&e)},Date.prototype.getFirstDayOfMonth=function(){var e=(this.getDay()-(this.getDate()-1))%7;return e<0?e+7:e},Date.prototype.getLastDayOfMonth=function(){var e=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return e<0?e+7:e},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},String.escape=function(e){return e.replace(/('|\\)/g,"\\$1")},String.leftPad=function(e,t,n){var i=new String(e);for(null==n&&(n=" ");i.length<t;)i=n+i;return i},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"},function(e){var t=e.fn.jquery.split("."),n=parseFloat(t[0]),i=parseFloat(t[1]);2>n&&8>i?(e.expr[":"].filterTableFind=function(t,n,i){return e(t).text().toUpperCase().indexOf(i[3].toUpperCase())>=0},e.expr[":"].filterTableFindAny=function(t,n,i){var r=i[3].split(/[\s,]/),o=[];return e.each(r,function(e,t){var n=t.replace(/^\s+|\s$/g,"");n&&o.push(n)}),!!o.length&&function(t){var n=!1;return e.each(o,function(i,r){return e(t).text().toUpperCase().indexOf(r.toUpperCase())>=0?(n=!0,!1):void 0}),n}},e.expr[":"].filterTableFindAll=function(t,n,i){var r=i[3].split(/[\s,]/),o=[];return e.each(r,function(e,t){var n=t.replace(/^\s+|\s$/g,"");n&&o.push(n)}),!!o.length&&function(t){var n=0;return e.each(o,function(i,r){e(t).text().toUpperCase().indexOf(r.toUpperCase())>=0&&n++}),n===o.length}}):(e.expr[":"].filterTableFind=jQuery.expr.createPseudo(function(t){return function(n){return e(n).text().toUpperCase().indexOf(t.toUpperCase())>=0}}),e.expr[":"].filterTableFindAny=jQuery.expr.createPseudo(function(t){var n=t.split(/[\s,]/),i=[];return e.each(n,function(e,t){var n=t.replace(/^\s+|\s$/g,"");n&&i.push(n)}),!!i.length&&function(t){var n=!1;return e.each(i,function(i,r){return e(t).text().toUpperCase().indexOf(r.toUpperCase())>=0?(n=!0,!1):void 0}),n}}),e.expr[":"].filterTableFindAll=jQuery.expr.createPseudo(function(t){var n=t.split(/[\s,]/),i=[];return e.each(n,function(e,t){var n=t.replace(/^\s+|\s$/g,"");n&&i.push(n)}),!!i.length&&function(t){var n=0;return e.each(i,function(i,r){e(t).text().toUpperCase().indexOf(r.toUpperCase())>=0&&n++}),n===i.length}})),e.fn.filterTable=function(t){var n={autofocus:!1,callback:null,containerClass:"filter-table",containerTag:"p",filterExpression:"filterTableFind",hideTFootOnFilter:!1,highlightClass:"alt",ignoreClass:"",ignoreColumns:[],inputSelector:null,inputName:"",inputType:"search",label:"Filter:",minChars:1,minRows:8,placeholder:"search this table",preventReturnKey:!0,quickList:[],quickListClass:"quick",quickListGroupTag:"",quickListTag:"a",visibleClass:"visible"},i=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},r=e.extend({},n,t),o=function(t,n){var i=t.find("tbody");if(""===n||n.length<r.minChars)i.find("tr").show().addClass(r.visibleClass),i.find("td").removeClass(r.highlightClass),r.hideTFootOnFilter&&t.find("tfoot").show();else{var o=i.find("td");if(i.find("tr").hide().removeClass(r.visibleClass),o.removeClass(r.highlightClass),r.hideTFootOnFilter&&t.find("tfoot").hide(),r.ignoreColumns.length){var a=[];r.ignoreClass&&(o=o.not("."+r.ignoreClass)),a=o.filter(":"+r.filterExpression+'("'+n.replace(/(['"])/g,"\\$1")+'")'),a.each(function(){var t=e(this),n=t.parent().children().index(t);-1===e.inArray(n,r.ignoreColumns)&&t.addClass(r.highlightClass).closest("tr").show().addClass(r.visibleClass)})}else r.ignoreClass&&(o=o.not("."+r.ignoreClass)),o.filter(":"+r.filterExpression+'("'+n.replace(/(['"])/g,"\\$1")+'")').addClass(r.highlightClass).closest("tr").show().addClass(r.visibleClass)}r.callback&&r.callback(n,t)};return this.each(function(){var t=e(this),n=t.find("tbody"),a=null,s=null,l=null,c=!0;"TABLE"===t[0].nodeName&&n.length>0&&(0===r.minRows||r.minRows>0&&n.find("tr").length>=r.minRows)&&!t.prev().hasClass(r.containerClass)&&(r.inputSelector&&1===e(r.inputSelector).length?(l=e(r.inputSelector),a=l.parent(),c=!1):(a=e("<"+r.containerTag+" />"),""!==r.containerClass&&a.addClass(r.containerClass),a.prepend(r.label+" "),l=e('<input type="'+r.inputType+'" placeholder="'+r.placeholder+'" name="'+r.inputName+'" />'),r.preventReturnKey&&l.on("keydown",function(e){return 13===(e.keyCode||e.which)?(e.preventDefault(),!1):void 0})),r.autofocus&&l.attr("autofocus",!0),e.fn.bindWithDelay?l.bindWithDelay("keyup",function(){o(t,e(this).val())},200):l.bind("keyup",function(){o(t,e(this).val())}),l.bind("click search input paste blur",function(){o(t,e(this).val())}),c&&a.append(l),r.quickList.length>0&&(s=r.quickListGroupTag?e("<"+r.quickListGroupTag+" />"):a,e.each(r.quickList,function(t,n){var o=e("<"+r.quickListTag+' class="'+r.quickListClass+'" />');o.text(i(n)),"A"===o[0].nodeName&&o.attr("href","#"),o.bind("click",function(e){e.preventDefault(),l.val(n).focus().trigger("click")}),s.append(o)}),s!==a&&a.append(s)),c&&t.before(a))})}}(jQuery),function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,r=i._mouseInit,o=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)}}}(jQuery),$(document).on("click",".skill_capture_smallbub_delete",function(){var e=$(this).parent(),t=e.data("skillname"),n=$("#skill_capture_user_id").data("id");MINDSUMO_ajaxLoader.load("/skill_list/remove_skill_from_user",{user_id:n,skill_name:t},"POST",null,{}),e.remove()}),$(document).on("click",".skill_capture_bub",function(){continuous_text_entry=0,add_skill_to_my_skills($(this).context.innerHTML),$(this).remove()});var is_autocomplete_on,continuous_text_entry,refresh_reco;$(document).ready(function(){is_autocomplete_on=!1,continuous_text_entry=0,refresh_reco=2,initialize_skill_field_autocomplete()}),$(document).on("click","#skill_new",function(){$(".ui-autocomplete.ui-front.ui-menu.ui-widget.ui-widget-content.ui-corner-all").css("z-index",1e4),initialize_skill_field_autocomplete()}),$(document).on("click",".skill_tags_for_contests",function(){var e=$(this).data("contestid"),t=$(this).data("skillid"),n=$(this).data("skillname");MINDSUMO_ajaxLoader.load("/skill_list/tag_skill_to_contest",{contest_id:e,skill_name:n},"POST",null,{}),$("#existing_skills_"+e).prepend("<span class='skill_tags_for_contests_existing new_bub' data-contestid ='"+e+"' data-skillid='"+t+"' data-skillname= '"+n+"'>"+n+"<span class='skill_tags_for_contests_existing_delete'>x</span></span>"),$(this).remove()}),$(document).on("click",".skill_tags_for_contests_existing_delete",function(){var e=$(this).parent(),t=e.data("contestid"),n=(e.data("skillid"),e.data("skillname"));MINDSUMO_ajaxLoader.load("/skill_list/untag_skill_from_contest",{contest_id:t,skill_name:n},"POST",null,{}),e.remove()}),$(document).on("keypress",".skill_tags_for_contests_field",function(e){if(13==e.which&&!is_autocomplete_on){var t=$(this).val();""!=t&&(add_skill_tags_to_contest(t,$(this).parent().data("id")),$(this).val(""),e.preventDefault(),$(this).autocomplete())}if(44==e.which){var t=$(this).val();$(this).val(t+", "),e.preventDefault()}}),$(document).ready(function(){is_autocomplete_on=!1,$(".skill_tags_for_contests_field").autocomplete({source:function(e,t){var n=e.term.split(/,\s*/),i=n.pop(),r=$.ui.autocomplete.filter(gon.skill_list,i),o=this.element.parent().data("skil")+","+e.term;r=$(r).not(o.split(/,\s*/)).get(),t(r.splice(0,7))},delay:30,select:function(){return is_autocomplete_on=!1,this.value=this.value+", ",!1},focus:function(e,t){var n=this.value;return n=n.split(","),n=n.slice(0,-1).join(),n+=""==n?"":", ",n+=t.item.value,is_autocomplete_on=!0,this.value=n,!1},close:function(){is_autocomplete_on=!1}})}),$(document).on("click",".major_category_tags_for_contests",function(){if(0==$(this).hasClass("major_category_selected")){$(this).parent().children().removeClass("major_category_selected"),$(this).addClass("major_category_selected");var e=$(this).data("categoryname"),t=$(this).data("contestid");MINDSUMO_ajaxLoader.load("/contests/"+t+"/assign_major_category",{major_category:e},"POST",null,{})}}),$(document).ready(function(){gon.save_draft_change=!0,1==gon.save_draft_interval&&(MINDSUMO_document.solutionDraftTimeout=setTimeout(function(){MINDSUMO_document.solutionDraftInterval=setInterval(saveSolutionAsDraft,6e4)},6e4))});var old_draft=null;$(document).ready(function(){$("#save_solution_button").click(function(){return saveSolutionAsDraft(),!1}),$("#submitted_solution").length>0&&$(document).keypress(keyPressHandler)}),$(document).on("submit",".solution_form",function(){$(".solution_error_message").hide();var e=$("#solution_summary").length>0?extractTextFromHtmlString($("#solution_summary").val()).length:1,t=$("#s3_uploaded_files_div").children().length+$(".solution_attachment").length,n=$("#solver_full_name");return n.length>0&&n.val().length<=0?($(".solver_name_empty").show(),!1):t>0?e>=0||($(".solution_summary_empty").show(),!1):e<$("#solution_summary").data("minlength")?($(".redactor_too_short").show(),!1):void 0}),$(document).on("click",".edit_profile_headtab",function(){var e=$(this).data("tab");$(".edit_profile_content_container").hide(),$(".edit_profile_tab_container_"+e).show(),$(".edit_profile_headtab").removeClass("edit_profile_headtab_selected"),$(this).addClass("edit_profile_headtab_selected"),$(".edit_user_error").css("display","none"),$(".edit_user_saved").hide()});var saving_profile_pic;$(document).ready(function(){$("#user_profile_pic_form").submit(function(){if(saving_profile_pic=!0,$("#profile_pic_crop_top").length>0&&$("#profile_pic_crop_left").length>0){var e=$("#my_profile_pic_id").css("left"),t=$("#my_profile_pic_id").css("top");if(t.length>0&&e.length>0){var n=parseInt(t.substring(0,t.length-2)),i=parseInt(e.substring(0,e.length-2));$("#profile_pic_crop_top").val(n),$("#profile_pic_crop_left").val(i)}}}),$(".user_profile_edit_form").on("ajax:success",function(e,t){1!=saving_profile_pic&&($(this).find(".user_editprofile_button").html("Update"),$(".edit_user_saved").show(),$(".user_editprofile_button").removeAttr("disabled")),t.profile_percent!=undefined&&$("#profile_percentage_current").html(t.profile_percent+"%")})}),$(document).on("click",".user_profile_edit_form input, .user_profile_edit_form textarea",function(){$(this).parents(".edit_profile_content_container").find(".edit_user_saved").hide()}),$(document).ready(function(){MINDSUMO_autocomplete.load(".school_autocomplete",gon.school_list,{singleItem:!0}),MINDSUMO_autocomplete.load(".major_autocomplete",gon.major_list,{singleItem:!0})}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==b||!(n!=y||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=y||!e[t])}function n(e,t){return typeof e[t]!=T}function i(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function r(e){return e&&N(e,S)&&R(e,w)}function o(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=T&&e(console,"log")&&console.log(t)}function s(e,t){O&&t?alert(e):a(e)}function l(e){P.initialized=!0,P.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,P.config.alertOnFail)}function c(e){s("Rangy warning: "+e,P.config.alertOnWarn)}function u(e){return e.message||e.description||String(e)}function d(){if(O&&!P.initialized){var t,n=!1,i=!1;e(document,"createRange")&&(t=document.createRange(),N(t,C)&&R(t,x)&&(n=!0));var s=o(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),r(t)&&(i=!0)),!n&&!i)return void l("Neither Range nor TextRange are available");P.initialized=!0,P.features={implementsDomRange:n,implementsTextRange:i};var c,d;for(var f in k)(c=k[f])instanceof g&&c.init(c,P);for(var h=0,p=F.length;p>h;++h)try{F[h](P)}catch(e){d="Rangy init listener threw an exception. Continuing. Detail: "+u(e),a(d)}}}function f(e,t,n){n&&(e+=" in module "+n.name),P.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function h(e,t,n,i){e[t]=function(){return f(t,n,i),e[n].apply(e,A.toArray(arguments))}}function p(e){e=e||window,d();for(var t=0,n=H.length;n>t;++t)H[t](e)}function g(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var i=new g(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(P,t),t.supported=!0}catch(t){var i="Module '"+e+"' failed to load: "+u(t);a(i),t.stack&&a(t.stack)}}});return k[e]=i,i}function v(){}function _(){}var y="object",b="function",T="undefined",x=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],w=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],N=i(e),D=i(t),R=i(n),E=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,i=e.length;i>n;++n)t(e[n],n)},k={},O=typeof window!=T&&typeof document!=T,A={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:N,areHostObjects:D,areHostProperties:R,isTextRange:r,getBody:o,forEach:E},P={version:"1.3.0",initialized:!1,isBrowser:O,supported:!0,util:A,features:{},modules:k,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==T||rangyAutoInitialize}};P.fail=l,P.warn=c;var M;!{}.hasOwnProperty?l("hasOwnProperty not supported"):(A.extend=M=function(e,t,n){var i,r;for(var o in t)t.hasOwnProperty(o)&&(i=e[o],r=t[o],n&&null!==i&&"object"==typeof i&&null!==r&&"object"==typeof r&&M(i,r,!0),e[o]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},A.createOptions=function(e,t){var n={};return M(n,t),e&&M(n,e),n}),O||l("Rangy can only run in a browser"),function(){var e;if(O){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,i=e.length;i>n;++n)t[n]=e[n];return t}),A.toArray=e}();var I;O&&(e(document,"addEventListener")?I=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?I=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),A.addListener=I);var F=[];A.deprecationNotice=f,A.createAliasForDeprecatedMethod=h,P.init=d,P.addInitListener=function(e){P.initialized?e(P):F.push(e)};var H=[];P.addShimListener=function(e){H.push(e)},O&&(P.shim=P.createMissingNativeApi=p,h(P,"createMissingNativeApi","shim")),g.prototype={init:function(){for(var e,t,n=this.dependencies||[],i=0,r=n.length;r>i;++i){if(t=n[i],!((e=k[t])&&e instanceof g))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){P.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){P.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},P.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var i=m(e,n,t);P.initialized&&P.supported&&i.init()},P.createCoreModule=function(e,t,n){m(e,t,n)},P.RangePrototype=v,P.rangePrototype=new v,P.selectionPrototype=new _,P.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==O||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)++t;return t}function o(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(F(i,n))return n;return null}function s(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function l(e,t){return s(e,t,!0)}function c(e,t,n){for(var i,r=n?e:e.parentNode;r;){if((i=r.parentNode)===t)return r;r=i}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function f(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function h(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),f(i,e),n)for(var o,a=0;o=n[a++];)o.node==e&&o.offset>t?(o.node=i,o.offset-=t):o.node==e.parentNode&&o.offset>r(e)&&++o.offset;return i}function p(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=O)return e.ownerDocument;if(typeof e.document!=O)return e.document;if(e.parentNode)return p(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var n=p(e);if(typeof n.defaultView!=O)return n.defaultView;if(typeof n.parentWindow!=O)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=O)return e.contentDocument;if(typeof e.contentWindow!=O)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=O)return e.contentWindow;if(typeof e.contentDocument!=O)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function _(e){return e&&A.isHostMethod(e,"setTimeout")&&A.isHostObject(e,"document")}function y(e,t,n){var i;if(e?A.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):p(e):_(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function b(e){for(var t;t=e.parentNode;)e=t;return e}function T(e,n,i,o){var s,l,u,d,f;if(e==i)return n===o?0:o>n?-1:1;if(s=c(i,e,!0))return n<=r(s)?-1:1;if(s=c(e,i,!0))return r(s)<o?-1:1;if(!(l=a(e,i)))throw new Error("comparePoints error: nodes have no common ancestor");if(u=e===l?l:c(e,l,!0),d=i===l?l:c(i,l,!0),u===d)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=l.firstChild;f;){if(f===u)return-1;if(f===d)return 1;f=f.nextSibling}}function x(e){try{return e.parentNode,!1}catch(e){return!0}}function C(e){if(!e)return"[No node]";if(H&&x(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+r(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function w(e){for(var t,n=p(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function S(e,t,n){var i=P(e),r=e.createElement("div");r.contentEditable=""+!!n,t&&(r.innerHTML=t);var o=i.firstChild;return o?i.insertBefore(r,o):i.appendChild(r),r}function N(e){return e.parentNode.removeChild(e)}function D(e){this.root=e,this._next=e}function R(e){return new D(e)}function E(e,t){this.node=e,this.offset=t}function k(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var O="undefined",A=e.util,P=A.getBody;A.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),A.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var M=document.createElement("div");A.areHostMethods(M,["insertBefore","appendChild","cloneNode"]||!A.areHostObjects(M,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),A.isHostProperty(M,"innerHTML")||t.fail("Element is missing innerHTML property");var I=document.createTextNode("test");A.areHostMethods(I,["splitText","deleteData","insertData","appendData","cloneNode"]||!A.areHostObjects(M,["previousSibling","nextSibling","childNodes","parentNode"])||!A.areHostProperties(I,["data"]))||t.fail("Incomplete Text Node implementation");var F=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},H=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",H=x(n),e.features.crashyTextNodes=H}();var j;typeof window.getComputedStyle!=O?j=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=O?j=function(e,t){return e.currentStyle?e.currentStyle[t]:""
}:t.fail("No means of obtaining computed style properties found"),D.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},E.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},k.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},k.prototype.toString=function(){return this.message},e.dom={arrayContains:F,isHtmlNamespace:n,parentElement:i,getNodeIndex:r,getNodeLength:o,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:u,isTextOrCommentNode:d,insertAfter:f,splitDataNode:h,getDocument:p,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:P,isWindow:_,getContentDocument:y,getRootContainer:b,comparePoints:T,isBrokenNode:x,inspectNode:C,getComputedStyleProperty:j,createTestElement:S,removeNode:N,fragmentFromNodeChildren:w,createIterator:R,DomPosition:E},e.DOMException=k}),P.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(L(e,t.startContainer)||L(e,t.endContainer))}function n(e){return e.document||W(e.startContainer)}function i(e){return X(e.startContainer)}function r(e){return new F(e.parentNode,$(e))}function o(e){return new F(e.parentNode,$(e)+1)}function a(e,t,n){var i=11==e.nodeType?e.firstChild:e;return j(t)?n==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:z(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function s(e,t,i){if(w(e),w(t),n(t)!=n(e))throw new H("WRONG_DOCUMENT_ERR");var r=B(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=B(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return i?0>=r&&o>=0:0>r&&o>0}function l(e){for(var t,i,r,o=n(e.range).createDocumentFragment();i=e.next();){if(t=e.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(r=e.getSubtreeIterator(),i.appendChild(l(r)),r.detach()),10==i.nodeType)throw new H("HIERARCHY_REQUEST_ERR");o.appendChild(i)}return o}function c(e,t,n){var i,r;n=n||{stop:!1};for(var o,a;o=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(o))return void(n.stop=!0);if(a=e.getSubtreeIterator(),c(a,t,n),a.detach(),n.stop)return}else for(i=M.createIterator(o);r=i.next();)if(!1===t(r))return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach()):e.remove()}function d(e){for(var t,i,r=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(d(i)),i.detach()):e.remove(),10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function f(e,t,n){var i,r=!(!t||!t.length),o=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var a=[];return c(new p(e,!1),function(t){if(!(r&&!i.test(t.nodeType)||o&&!n(t))){var s=e.startContainer;if(t!=s||!j(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&j(l)&&0==e.endOffset||a.push(t)}}}),a}function h(e){return"["+("undefined"==typeof e.getName?"Range":e.getName())+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&j(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||j(this.sc)?U(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||j(this.ec)?U(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){return function(t,n){for(var i,r=n?t:t.parentNode;r;){if(i=r.nodeType,Y(e,i))return r;r=r.parentNode}return null}}function m(e,t){if(ie(e,t))throw new H("INVALID_NODE_TYPE_ERR")}function v(e,t){if(!Y(t,e.nodeType))throw new H("INVALID_NODE_TYPE_ERR")}function _(e,t){if(0>t||t>(j(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function y(e,t){if(te(e,!0)!==te(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function b(e){if(ne(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function T(e,t){if(!e)throw new H(t)}function x(e,t){return t<=(j(e)?e.length:e.childNodes.length)}function C(e){return!!e.startContainer&&!!e.endContainer&&!(J&&(M.isBrokenNode(e.startContainer)||M.isBrokenNode(e.endContainer)))&&X(e.startContainer)==X(e.endContainer)&&x(e.startContainer,e.startOffset)&&x(e.endContainer,e.endOffset)}function w(e){if(!C(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function S(e,t){w(e);var n=e.startContainer,i=e.startOffset,r=e.endContainer,o=e.endOffset,a=n===r;j(r)&&o>0&&o<r.length&&z(r,o,t),j(n)&&i>0&&i<n.length&&(n=z(n,i,t),a?(o-=i,r=n):r==n.parentNode&&o>=$(n)&&o++,i=0),e.setStartAndEnd(n,i,r,o)}function N(e){w(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function D(e){e.START_TO_START=le,e.START_TO_END=ce,e.END_TO_END=ue,e.END_TO_START=de,e.NODE_BEFORE=fe,e.NODE_AFTER=he,e.NODE_BEFORE_AND_AFTER=pe,e.NODE_INSIDE=ge}function R(e){D(e),D(e.prototype)}function E(e,t){return function(){w(this);var n,i,r=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,l=new p(this,!0);r!==s&&(n=U(r,s,!0),i=o(n),r=i.node,a=i.offset),c(l,b),l.reset();var u=e(l);return l.detach(),t(this,r,a,r,a),u}}function k(n,i){function a(e,t){return function(n){v(n,G),v(X(n),Q);var i=(e?r:o)(n);(t?s:l)(this,i.node,i.offset)}}function s(e,t,n){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(r)||1==B(t,n,r,o))&&(r=t,o=n),i(e,t,n,r,o))}function l(e,t,n){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(r)||-1==B(t,n,r,o))&&(r=t,o=n),i(e,r,o,t,n))}var c=function(){};c.prototype=e.rangePrototype,n.prototype=new c,I.extend(n.prototype,{setStart:function(e,t){m(e,!0),_(e,t),s(this,e,t)},setEnd:function(e,t){m(e,!0),_(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],r=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:r=e[2],o=e[3]}i(this,t,n,r,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){w(this),e?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){m(e,!0),i(this,e,0,e,q(e))},selectNode:function(e){m(e,!1),v(e,G);var t=r(e),n=o(e);i(this,t.node,t.offset,n.node,n.offset)},extractContents:E(d,i),deleteContents:E(u,i),canSurroundContents:function(){w(this),b(this.startContainer),b(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},splitBoundaries:function(){S(this)},splitBoundariesPreservingPositions:function(e){S(this,e)},normalizeBoundaries:function(){w(this);var e,t=this.startContainer,n=this.startOffset,r=this.endContainer,o=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,o=e.length,e.appendData(t.data),V(t))},s=function(e){var i=e.previousSibling;if(i&&i.nodeType==e.nodeType){t=e;var a=e.length;if(n=i.length,e.insertData(0,i.data),V(i),t==r)o+=n,r=t;else if(r==e.parentNode){var s=$(e);o==s?(r=e,o=a):o>s&&o--}}},l=!0;if(j(r))o==r.length?a(r):0==o&&(e=r.previousSibling)&&e.nodeType==r.nodeType&&(o=e.length,t==r&&(l=!1),e.appendData(r.data),V(r),r=e);else{if(o>0){var c=r.childNodes[o-1];c&&j(c)&&a(c)}l=!this.collapsed}if(l){if(j(t))0==n?s(t):n==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(r==e&&(r=t,o+=t.length),t.appendData(e.data),V(e));else if(n<t.childNodes.length){var u=t.childNodes[n];u&&j(u)&&s(u)}}else t=r,n=o;i(this,t,n,r,o)},collapseToPoint:function(e,t){m(e,!0),_(e,t),this.setStartAndEnd(e,t)}}),R(n)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function A(e,t,n,i,r){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=r,e.document=M.getDocument(t),O(e)}function P(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,O(this)}var M=e.dom,I=e.util,F=M.DomPosition,H=e.DOMException,j=M.isCharacterDataNode,$=M.getNodeIndex,L=M.isOrIsAncestorOf,W=M.getDocument,B=M.comparePoints,z=M.splitDataNode,U=M.getClosestAncestorIn,q=M.getNodeLength,Y=M.arrayContains,X=M.getRootContainer,J=e.features.crashyTextNodes,V=M.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,j(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!j(n)||n!==this.sc&&n!==this.ec?n.parentNode&&V(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){return t(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new P(n(this.range));var t=this._current,i=t,r=0,o=t,a=q(t);L(t,this.sc)&&(i=this.sc,r=this.so),L(t,this.ec)&&(o=this.ec,a=this.eo),A(e,i,r,o,a)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],Q=[2,9,11],Z=[5,6,10,12],K=[1,3,4,5,7,8,10,11],ee=[1,3,4,5,7,8],te=g([9,11]),ne=g(Z),ie=g([6,10,12]),re=document.createElement("style"),oe=!1;try{re.innerHTML="<b>x</b>",oe=3==re.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=oe;var ae=oe?function(e){var t=this.startContainer,n=W(t);if(!t)throw new H("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:j(t)&&(i=M.parentElement(t)),i=null===i||"HTML"==i.nodeName&&M.isHtmlNamespace(W(i).documentElement)&&M.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=e,M.fragmentFromNodeChildren(i)}:function(e){var t=n(this),i=t.createElement("body");return i.innerHTML=e,M.fragmentFromNodeChildren(i)},se=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],le=0,ce=1,ue=2,de=3,fe=0,he=1,pe=2,ge=3;I.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){w(this),y(this.startContainer,t.startContainer);var n,i,r,o,a=e==de||e==le?"start":"end",s=e==ce||e==le?"start":"end";return n=this[a+"Container"],i=this[a+"Offset"],r=t[s+"Container"],o=t[s+"Offset"],B(n,i,r,o)},insertNode:function(e){if(w(this),v(e,K),b(this.startContainer),L(e,this.startContainer))throw new H("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){w(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&j(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var i=new p(this,!0);return e=l(i),i.detach(),e},canSurroundContents:function(){w(this),b(this.startContainer),b(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(v(e,ee),!this.canSurroundContents())throw new H("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this);for(var e,t=new P(n(this)),i=se.length;i--;)e=se[i],t[e]=this[e];return t},toString:function(){w(this);var e=this.startContainer;if(e===this.endContainer&&j(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){w(this);var t=e.parentNode,n=$(e);if(!t)throw new H("NOT_FOUND_ERR");var i=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>i?r>0?pe:fe:r>0?he:ge},comparePoint:function(e,t){return w(this),T(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),B(e,t,this.startContainer,this.startOffset)<0?-1:B(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ae,toHtml:function(){return N(this)},intersectsNode:function(e,t){if(w(this),X(e)!=i(this))return!1;var n=e.parentNode,r=$(e);if(!n)return!0;var o=B(n,r,this.endContainer,this.endOffset),a=B(n,r+1,this.startContainer,this.startOffset);return t?0>=o&&a>=0:0>o&&a>0},isPointInRange:function(e,t){return w(this),T(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),B(e,t,this.startContainer,this.startOffset)>=0&&B(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=B(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=B(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==B(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==B(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new H("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ge},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,q(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();return t.setEnd(i,i.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return w(this),f(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var i=n(this),r=e.createRange(i);t=t||M.getBody(i),r.selectNodeContents(t);var o=this.intersection(r),a=0,s=0;return o&&(r.setEnd(o.startContainer,o.startOffset),a=r.toString().length,s=a+o.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,r,o,a,s=[t],l=!1,c=!1;!c&&(i=s.pop());)if(3==i.nodeType)r=n+i.length,!l&&e.start>=n&&e.start<=r&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=r&&(this.setEnd(i,e.end-n),c=!0),n=r;else for(a=i.childNodes,o=a.length;o--;)s.push(a[o])},getName:function(){return"DomRange"},equals:function(e){return P.rangesEqual(this,e)},isValid:function(){return C(this)},inspect:function(){return h(this)},detach:function(){}}),k(P,A),I.extend(P,{rangeProperties:se,RangeIterator:p,copyComparisonConstants:R,createPrototypeRange:k,inspect:h,toHtml:N,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=P}),P.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,r=e.dom,o=e.util,a=r.DomPosition,s=e.DomRange,l=r.getBody,c=r.getContentDocument,u=r.isCharacterDataNode;if(e.features.implementsDomRange&&function(){function i(e){for(var t,n=f.length;n--;)t=f[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,i,r){var o=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==i||e.endOffset!=r,s=!e.equals(e.nativeRange);(o||a||s)&&(e.setEnd(i,r),e.setStart(t,n))}var u,d,f=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,i(this)},s.createPrototypeRange(n,a),u=n.prototype,u.selectNode=function(e){this.nativeRange.selectNode(e),i(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(e){this.nativeRange.surroundContents(e),i(this)},u.collapse=function(e){this.nativeRange.collapse(e),i(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){i(this)},u.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");l(document).appendChild(h);var p=document.createRange();p.setStart(h,0),p.setEnd(h,0);try{p.setStart(h,1),u.setStart=function(e,t){this.nativeRange.setStart(e,t),i(this)},u.setEnd=function(e,t){this.nativeRange.setEnd(e,t),i(this)},d=function(e){return function(t){this.nativeRange[e](t),i(this)}}}catch(e){u.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}i(this)},u.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}i(this)},d=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}i(this)}}}u.setStartBefore=d("setStartBefore","setEndBefore"),u.setStartAfter=d("setStartAfter","setEndAfter"),u.setEndBefore=d("setEndBefore","setStartBefore"),u.setEndAfter=d("setEndAfter","setStartAfter"),u.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},p.selectNodeContents(h),p.setEnd(h,3);var g=document.createRange();g.selectNodeContents(h),g.setEnd(h,4),g.setStart(h,2),u.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,g)&&1==p.compareBoundaryPoints(p.END_TO_START,g)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,_=l(document);_.appendChild(m),p.setStart(v,1),p.setEnd(v,2),p.deleteContents(),"13"==v.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},u.extractContents=function(){var e=this.nativeRange.extractContents();return i(this),e}),_.removeChild(m),_=null,o.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(h),u.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var d=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var o=n.parentElement(),a=i==o?i:r.getCommonAncestor(i,o);return a==t?a:r.getCommonAncestor(t,a)},f=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,i,o){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(r.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var d=r.getDocument(l).createElement("span");d.parentNode&&r.removeNode(d);for(var f,h,p,g,m,v=n?"StartToStart":"StartToEnd",_=o&&o.containerElement==l?o.nodeIndex:0,y=l.childNodes.length,b=y,T=b;T==y?l.appendChild(d):l.insertBefore(d,l.childNodes[T]),s.moveToElementText(d),0!=(f=s.compareEndPoints(v,e))&&_!=b;){if(-1==f){if(b==_+1)break;_=T}else b=b==_+1?_:T;T=Math.floor((_+b)/2),l.removeChild(d)}if(m=d.nextSibling,-1==f&&m&&u(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var x;if(/[\r\n]/.test(m.data)){var C=s.duplicate(),w=C.text.replace(/\r\n/g,"\r").length;for(x=C.moveStart("character",w);-1==(f=C.compareEndPoints("StartToEnd",C));)x++,C.moveStart("character",1)}else x=s.text.length;g=new a(m,x)}else h=(i||!n)&&d.previousSibling,p=(i||n)&&d.nextSibling,g=p&&u(p)?new a(p,0):h&&u(h)?new a(h,h.data.length):new a(l,r.getNodeIndex(d));return r.removeNode(d),{boundaryPosition:g,nodeInfo:{nodeIndex:T,containerElement:l}}},p=function(e,t){var n,i,o,a,s=e.offset,c=r.getDocument(e.node),d=l(c).createTextRange(),f=u(e.node);return f?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),o=c.createElement("span"),o.innerHTML="&#feff;",n?i.insertBefore(o,n):i.appendChild(o),d.moveToElementText(o),d.collapse(!t),i.removeChild(o),f&&d[t?"moveStart":"moveEnd"]("character",s),d};i=function(e){this.textRange=e,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var e,t,n,i=d(this.textRange);f(this.textRange)?t=e=h(this.textRange,i,!0,!0).boundaryPosition:(n=h(this.textRange,i,!0,!1),e=n.boundaryPosition,t=h(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(i);var g=function(e){if(e.collapsed)return p(new a(e.startContainer,e.startOffset),!0);var t=p(new a(e.startContainer,e.startOffset),!0),n=p(new a(e.endContainer,e.endOffset),!1),i=l(s.getRangeDocument(e)).createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i};if(i.rangeToTextRange=g,i.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=i),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},o.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),o.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),P.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function i(e,n){if(e){if(R.isWindow(e))return e;if(e instanceof v)return e.win;var i=R.getContentDocument(e,t,n);return R.getWindow(i)}return window}function r(e){return i(e,"getWinSelection").getSelection()}function o(e){return i(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==R.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var i=n?"end":"start",r=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function u(t){var n;return t instanceof O?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof A?n=t.nativeRange:I.implementsDomRange&&t instanceof R.getWindow(t.startContainer).Range&&(n=t),n}function d(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!R.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var n=e.getNodes();if(!d(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&"undefined"!=typeof e.text}function p(e,t){var n=new A(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(h(n))p(t,n);else{t.rangeCount=n.length;for(var i,r=H(n.item(0)),o=0;o<t.rangeCount;++o)i=e.createRange(r),i.selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var i=e.docSelection.createRange(),r=f(n),o=H(i.item(0)),a=j(o).createControlRange(),s=0,l=i.length;l>s;++s)a.add(i.item(s));try{a.add(r)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),g(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function _(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function y(e,t){for(var n,i,r=te.length;r--;)if(n=te[r],i=n.selection,"deleteAll"==t)_(i);else if(n.win==e)return"delete"==t?(te.splice(r,1),!0):i;return"deleteAll"==t&&(te.length=0),null}function b(e,n){for(var i,r=H(n[0].startContainer),o=j(r).createControlRange(),a=0,s=n.length;s>a;++a){i=f(n[a]);try{o.add(i)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),g(e)}function T(e,t){if(e.win.document!=H(t))throw new P("WRONG_DOCUMENT_ERR")}function x(t){return function(n,i){var r;this.rangeCount?(r=this.getRangeAt(0),r["set"+(t?"Start":"End")](n,i)):(r=e.createRange(this.win.document),r.setStartAndEnd(n,i)),this.setSingleRange(r,this.isBackward())}}function C(e){var t=[],n=new M(e.anchorNode,e.anchorOffset),i=new M(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,a=e.rangeCount;a>o;++o)t[o]=O.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.config.checkSelectionRanges=!0;var w,S,N="boolean",D="number",R=e.dom,E=e.util,k=E.isHostMethod,O=e.DomRange,A=e.WrappedRange,P=e.DOMException,M=R.DomPosition,I=e.features,F="Control",H=R.getDocument,j=R.getBody,$=O.rangesEqual,L=k(window,"getSelection"),W=E.isHostObject(document,"selection");I.implementsWinGetSelection=L,I.implementsDocSelection=W;var B=W&&(!L||e.config.preferTextRange);if(B)w=o,e.isSelectionValid=function(e){var t=i(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||H(n.createRange().parentElement())==t};else{if(!L)return t.fail("Neither document.selection or window.getSelection() detected."),!1;w=r,e.isSelectionValid=function(){return!0}}e.getNativeSelection=w;var z=w();if(!z)return t.fail("Native selection was null (possibly issue 138?)"),!1;var U=e.createNativeRange(document),q=j(document),Y=E.areHostProperties(z,["anchorNode","focusNode","anchorOffset","focusOffset"]);I.selectionHasAnchorAndFocus=Y;var X=k(z,"extend");I.selectionHasExtend=X;var J=typeof z.rangeCount==D;I.selectionHasRangeCount=J;var V=!1,G=!0,Q=X?function(t,n){var i=O.getRangeDocument(n),r=e.createRange(i);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(u(r)),t.extend(n.startContainer,n.startOffset)}:null;E.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&typeof z.rangeCount==D&&I.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,r=[],o=a(t),s=0;n>s;++s)r[s]=t.getRangeAt(s);var l=R.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("   ")),u=document.createRange();if(u.setStart(c,1),u.collapse(!0),t.removeAllRanges(),t.addRange(u),G=1==t.rangeCount,t.removeAllRanges(),!i){var d=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(d&&parseInt(d[1])>=36)V=!1;else{var f=u.cloneRange();u.setStart(c,0),f.setEnd(c,3),f.setStart(c,2),t.addRange(u),t.addRange(f),V=2==t.rangeCount}}for(R.removeNode(l),t.removeAllRanges(),s=0;n>s;++s)0==s&&o?Q?Q(t,r[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(r[s])):t.addRange(r[s])}}(),I.selectionSupportsMultipleRanges=V,I.collapsedNonEditableSelectionsSupported=G;var Z,K=!1;q&&k(q,"createControlRange")&&(Z=q.createControlRange(),E.areHostProperties(Z,["item","add"])&&(K=!0)),I.implementsControlRange=K,S=Y?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};var ee;k(z,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:Y&&(ee=function(t){var n=H(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),v.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof v)return e.refresh(),e;e=i(e,"getNativeSelection");var t=y(e),n=w(e),r=W?o(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new v(n,r,e),te.push({win:e,selection:t})),t};e.getSelection=ne,E.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ie=v.prototype;if(!B&&Y&&E.areHostMethods(z,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var re=function(e,t){Q(e.nativeSelection,t),e.refresh()};ie.addRange=J?function(t,i){if(K&&W&&this.docSelection.type==F)m(this,t);else if(n(i)&&X)re(this,t);else{var r;V?r=this.rangeCount:(this.removeAllRanges(),r=0);var o=u(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var a=ee(this.nativeSelection,this.rangeCount-1);a&&!$(a,t)&&(t=new A(a))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=S(this)}else this.refresh()}}:function(e,t){n(t)&&X?re(this,e):(this.nativeSelection.addRange(u(e)),this.refresh())},ie.setRanges=function(e){if(K&&W&&e.length>1)b(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(k(z,"empty")&&k(U,"select")&&K&&B))return t.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=H(this.anchorNode);else if(this.docSelection.type==F){var t=this.docSelection.createRange();t.length&&(e=H(t.item(0)))}if(e){j(e).createTextRange().select(),this.docSelection.empty()}}}catch(e){}c(this)},ie.addRange=function(t){this.docSelection.type==F?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ie.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?b(this,e):t&&this.addRange(e[0])}}ie.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new P("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var oe;if(B)oe=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=j(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==F?g(t):h(n)?p(t,n):c(t)};else if(k(z,"getRangeAt")&&typeof z.rangeCount==D)oe=function(t){if(K&&W&&t.docSelection.type==F)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=S(t)}else c(t)};else{if(!Y||typeof z.isCollapsed!=N||typeof U.collapsed!=N||!I.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;oe=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=S(e)):c(e)}}ie.refresh=function(e){
var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(oe(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;r--;)if(!$(t[r],this._ranges[r]))return!0;return!1}};var ae=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,r=n.length;r>i;++i)$(t,n[i])||e.addRange(n[i]);e.rangeCount||c(e)};ie.removeRange=K&&W?function(e){if(this.docSelection.type==F){for(var t,n=this.docSelection.createRange(),i=f(e),r=H(n.item(0)),o=j(r).createControlRange(),a=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==i||a?o.add(n.item(s)):a=!0;o.select(),g(this)}else ae(this,e)}:function(e){ae(this,e)};var se;!B&&Y&&I.implementsDomRange?(se=a,ie.isBackward=function(){return se(this)}):se=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},ie.collapse=function(t,n){T(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new P("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new P("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ie.selectAllChildren=function(t){T(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(K&&W&&this.docSelection.type==F){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),R.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,r=n.length;r>i;++i)n[i].deleteContents();this.addRange(n[r-1])}}},ie.eachRange=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(e(this.getRangeAt(n)))return t},ie.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ie.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ie.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t||[]))}),n},ie.setStart=x(!0),ie.setEnd=x(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},ie.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ie.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ie.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ie.moveToBookmark=function(t){for(var n,i,r=[],o=0;n=t.rangeBookmarks[o++];)i=e.createRange(this.win),i.moveToBookmark(n),r.push(i);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},ie.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ie.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},ie.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(O.toHtml(t))}),e.join("")},I.implementsTextRange&&(ie.getNativeTextRange=function(){var n;if(n=this.docSelection){var i=n.createRange();if(h(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return C(this)},ie.detach=function(){y(this.win,"delete"),_(this)},v.detachAll=function(){y(null,"deleteAll")},v.inspect=C,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=ie,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})});var j=!1,$=function(){j||(j=!0,!P.initialized&&P.config.autoInitialize&&d())};return O&&("complete"==document.readyState?$():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",$,!1),I(window,"load",$))),P},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function o(e,t){return!!e&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function a(e,t){return"object"==typeof e.classList?e.classList.contains(t):o("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function s(e,t){if("object"==typeof e.classList)e.classList.add(t);else{var n="string"==typeof e.className,i=n?e.className:e.getAttribute("class");i?o(i,t)||(i+=" "+t):i=t,n?e.className=i:e.setAttribute("class",i)}}function l(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function c(e){return e&&e.split(/\s+/).sort().join(" ")}function u(e){return c(l(e))}function d(e,t){return u(e)==u(t)}function f(e,t){for(var n=t.split(/\s+/),i=0,o=n.length;o>i;++i)if(!a(e,r(n[i])))return!1;return!0}function h(e){var t=e.parentNode;return t&&1==t.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function p(e,t,n,i,r){var o=e.node,a=e.offset,s=o,l=a;o==i&&a>r&&++l,o!=t||a!=n&&a!=n+1||(s=i,l+=r-n),o==t&&a>n+1&&--l,e.node=s,e.offset=l}function g(e,t,n){e.node==t&&e.offset>n&&--e.offset}function m(e,t,n,i){-1==n&&(n=t.childNodes.length);var r=e.parentNode,o=H.getNodeIndex(e);W(i,function(e){p(e,r,o,t,n)}),t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function v(e,t){var n=e.parentNode,i=H.getNodeIndex(e);W(t,function(e){g(e,n,i)}),H.removeNode(e)}function _(e,t,n,i,r){for(var o,a=[];o=e.firstChild;)m(o,t,n++,r),a.push(o);return i&&v(e,r),a}function y(e,t){return _(e,e.parentNode,H.getNodeIndex(e),!0,t)}function b(e,t){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e);return""!=(i?i.toString():"")}function T(e){for(var t,n=e.getNodes([3]),i=0;(t=n[i])&&!b(e,t);)++i;for(var r=n.length-1;(t=n[r])&&!b(e,t);)--r;return n.slice(i,r+1)}function x(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,r,o=0,a=e.attributes.length;a>o;++o)if(n=e.attributes[o],"class"!=(r=n.name)){if(i=t.attributes.getNamedItem(r),null===n!=(null===i))return!1;if(n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function C(e,t){for(var n,i=0,r=e.attributes.length;r>i;++i)if(n=e.attributes[i].name,(!t||!$(t,n))&&e.attributes[i].specified&&"class"!=n)return!0;return!1}function w(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||Y(e)&&!Y(e.parentNode))}function S(e){return(Y(e)||1!=e.nodeType&&Y(e.parentNode))&&!w(e)}function N(e){return e&&1==e.nodeType&&!X.test(q(e,"display"))}function D(e){if(0==e.data.length)return!0;if(J.test(e.data))return!1;switch(q(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return N(e.previousSibling)||N(e.nextSibling)}function R(e){var t,n,i=[];for(t=0;n=e[t++];)i.push(new j(n.startContainer,n.startOffset),new j(n.endContainer,n.endOffset));return i}function E(e,t){for(var n,i,r,o=0,a=e.length;a>o;++o)n=e[o],i=t[2*o],r=t[2*o+1],n.setStartAndEnd(i.node,i.offset,r.node,r.offset)}function k(e,t){return H.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:t>0&&t<e.childNodes.length}function O(e,n,i,r){var o,a,s=0==i;if(H.isAncestorOf(n,e))return e;if(H.isCharacterDataNode(n)){var l=H.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(k(n,i)){o=n.cloneNode(!1),a=n.parentNode,o.id&&o.removeAttribute("id");for(var c,u=0;c=n.childNodes[i];)m(c,o,u++,r);return m(o,a,H.getNodeIndex(n)+1,r),n==e?o:O(e,a,H.getNodeIndex(o),r)}if(e!=n){o=n.parentNode;var d=H.getNodeIndex(n);return s||d++,O(e,o,d,r)}return e}function A(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&d(e,t)&&x(e,t)&&"inline"==q(e,"display")&&"inline"==q(t,"display")}function P(e){var t=e?"nextSibling":"previousSibling";return function(n,i){var r=n.parentNode,o=n[t];if(o){if(o&&3==o.nodeType)return o}else if(i&&(o=r[t])&&1==o.nodeType&&A(r,o)){var a=o[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}function M(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function I(e,t,i){var o,a,s,l,u=this;u.cssClass=u.className=e;var d=null,f={};if("object"==typeof t&&null!==t){for("undefined"!=typeof t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),i=t.tagNames,d=t.elementProperties,f=t.elementAttributes,a=0;l=Q[a++];)t.hasOwnProperty(l)&&(u[l]=t[l]);o=t.normalize}else o=t;u.normalize=void 0===o||o,u.attrExceptions=[];var h=document.createElement(u.elementTagName);u.elementProperties=u.copyPropertiesToElement(d,h,!0),n(f,function(e,t){u.attrExceptions.push(e),f[e]=""+t}),u.elementAttributes=f,u.elementSortedClassName=u.elementProperties.hasOwnProperty("className")?c(u.elementProperties.className+" "+e):e,u.applyToAnyTagName=!1;var p=typeof i;if("string"==p)"*"==i?u.applyToAnyTagName=!0:u.tagNames=r(i.toLowerCase()).split(/\s*,\s*/);else if("object"==p&&"number"==typeof i.length)for(u.tagNames=[],a=0,s=i.length;s>a;++a)"*"==i[a]?u.applyToAnyTagName=!0:u.tagNames.push(i[a].toLowerCase());else u.tagNames=[u.elementTagName]}function F(e,t,n){return new I(e,t,n)}var H=e.dom,j=H.DomPosition,$=H.arrayContains,L=e.util,W=L.forEach,B="span",z=L.isHostMethod(document,"createElementNS"),U=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if("object"==typeof t.classList)t.classList.remove(n);else{var i="string"==typeof t.className,r=i?t.className:t.getAttribute("class");r=r.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e),i?t.className=r:t.setAttribute("class",r)}}}(),q=H.getComputedStyleProperty,Y=function(){return"boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||Y(e.parentNode))}}(),X=/^inline(-block|-table)?$/i,J=/[^\r\n\t\f \u200B]/,V=P(!1),G=P(!0);M.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){var i,r=H.getNodeIndex(n),o=[],a=0;W(t,function(t,s){i=t.parentNode,s>0&&(i.removeChild(t),i.hasChildNodes()||H.removeNode(i),e&&W(e,function(e){e.node==t&&(e.node=n,e.offset+=a),e.node==i&&e.offset>r&&--e.offset==r+1&&len-1>s&&(e.node=n,e.offset=a)})),o[s]=t.data,a+=t.data.length}),n.data=o.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return W(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var Q=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Z={};I.prototype={elementTagName:B,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var i,r,o,a,l,u,d={};for(var f in e)if(e.hasOwnProperty(f))if(a=e[f],l=t[f],"className"==f)s(t,a),s(t,this.className),t[f]=c(t[f]),n&&(d[f]=a);else if("style"==f){r=l,n&&(d[f]=o={});for(i in e[f])e[f].hasOwnProperty(i)&&(r[i]=a[i],n&&(o[i]=r[i]));this.attrExceptions.push(f)}else t[f]=a,n&&(d[f]=t[f],u=Z.hasOwnProperty(f)?Z[f]:f,this.attrExceptions.push(u));return n?d:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return $(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&a(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||S(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&D(e)},postApply:function(e,t,n,r){var o,a,s=e[0],l=e[e.length-1],c=[],u=s,d=l,f=0,h=l.length;W(e,function(e){a=V(e,!r),a?(o||(o=new M(a),c.push(o)),o.textNodes.push(e),e===s&&(u=o.textNodes[0],f=u.length),e===l&&(d=o.textNodes[0],h=o.getLength())):o=null});var p=G(l,!r);if(p&&(o||(o=new M(l),c.push(o)),o.textNodes.push(p)),c.length){for(i=0,len=c.length;len>i;++i)c[i].doMerge(n);t.setStartAndEnd(u,f,d,h)}},createContainer:function(e){var t,n=H.getDocument(e),i=z&&!H.isHtmlNamespace(e)&&(t=e.namespaceURI)?n.createElementNS(e.namespaceURI,this.elementTagName):n.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,i,!1),this.copyAttributesToElement(this.elementAttributes,i),s(i,this.className),this.onElementCreate&&this.onElementCreate(i,this),i},elementHasProperties:function(e,t){var i=this;return n(t,function(t,n){if("className"==t)return f(e,n);if("object"==typeof n){if(!i.elementHasProperties(e[t],n))return!1}else if(e[t]!==n)return!1})},elementHasAttributes:function(e,t){return n(t,function(t,n){return e.getAttribute(t)===n&&void 0})},applyToTextNode:function(e){if(h(e)){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&this.appliesToElement(t)&&this.elementHasProperties(t,this.elementProperties)&&this.elementHasAttributes(t,this.elementAttributes))s(t,this.className);else{var n=e.parentNode,i=this.createContainer(n);n.insertBefore(i,e),i.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&u(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!C(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),i=[e],r=R(i);W(n,function(e){v(e,r)}),E(i,r)},undoToTextNode:function(e,t,n,i){if(!t.containsNode(n)){var r=t.cloneRange();r.selectNode(n),r.isPointInRange(t.endContainer,t.endOffset)&&(O(n,t.endContainer,t.endOffset,i),t.setEndAfter(n)),r.isPointInRange(t.startContainer,t.startOffset)&&(n=O(n,t.startContainer,t.startOffset,i))}this.isRemovable(n)?y(n,i):U(n,this.className)},splitAncestorWithClass:function(e,t,n){var i=this.getSelfOrAncestorWithClass(e);i&&O(i,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?y(e,t):U(e,this.className)},applyToRange:function(e,t){var n=this;t=t||[];var i=R(t||[]);e.splitBoundariesPreservingPositions(i),n.removeEmptyElements&&n.removeEmptyContainers(e);var r=T(e);if(r.length){W(r,function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,i)});var o=r[r.length-1];e.setStartAndEnd(r[0],0,o,o.length),n.normalize&&n.postApply(r,e,i,!1),E(t,i)}var a=n.getEmptyElements(e);W(a,function(e){s(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this;t=t||[];var i=R(t);e.splitBoundariesPreservingPositions(i),n.removeEmptyElements&&n.removeEmptyContainers(e,i);var r,o,a=T(e),s=a[a.length-1];if(a.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,i),n.splitAncestorWithClass(e.startContainer,e.startOffset,i);for(var l=0,c=a.length;c>l;++l)r=a[l],(o=n.getSelfOrAncestorWithClass(r))&&n.isModifiable(r)&&n.undoToAncestor(o,i);e.setStartAndEnd(a[0],0,s,s.length),n.normalize&&n.postApply(a,e,i,!0),E(t,i)}var u=n.getEmptyElements(e);W(u,function(e){U(e,n.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),i=e.getSelection(t).getAllRanges();this.undoToRanges(i),n.setRanges(i)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,i=0;n=t[i++];)if(!this.isIgnorableWhiteSpaceNode(n)&&b(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var i=n.getSelfOrAncestorWithClass(e);i&&!$(t,i)&&t.push(i)}),t},detach:function(){}},I.util={hasClass:a,addClass:s,removeClass:U,getClass:l,hasSameClasses:d,hasAllClasses:f,replaceWithOwnChildren:y,elementsHaveSameNonClassAttributes:x,elementHasNonClassAttributes:C,splitNodeAt:O,isEditableElement:Y,isEditingHost:w,isEditable:S},e.CssClassApplier=e.ClassApplier=I,e.createClassApplier=F,L.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)}),e},this);var contentHighlightWorker=function(e,t){var n=this;this.element=e,this.settings={highlightableType:t.highlightableType||"",highlightableId:t.highlightableId||"",highlightableColumn:t.highlightableColumn||"",readOnly:t.readOnly||!1,confirmHighlight:t.confirmHighlight||!1,showDiscussion:t.showDiscussionCallback||!1,nodeIdentifierKey:t.nodeIdentifierKey||"chnode",highlightClass:t.highlightClass||"content-highlight",highlightIdentifyClassRoot:t.highlightIdentifyClassRoot||"content-highlight-identifier-",highlightLifetimeClassRoot:t.highlightLifetimeClassRoot||"content-highlight-lifetime-",highlightActiveClass:t.highlightActiveClass||"content-highlight-active",popTipClass:t.popTipClass||"content-highlight-poptip",popTipDefaultHead:t.popTipDefaultHead||"Highlight",addToServerPath:t.addToServerPath||e.dataset.addhighlightspath||"/content_highlights/add?",removeFromServerPath:t.removeFromServerPath||e.dataset.removehighlightspath||"/content_highlights/remove?"},this.sendToServerParams="highlightable_type="+this.settings.highlightableType+"&highlightable_id="+this.settings.highlightableId+"&highlightable_column="+this.settings.highlightableColumn,rangy&&rangy.getSelection&&(this.init=function(){rangy.init(),this.getContentHighlightsFromServer(),this.settings.readOnly||(this.settings.confirmHighlight?e.addEventListener("mouseup",this.showPopTipForSelection):e.addEventListener("mouseup",this.initializeHighlighter))},this.showPopTipForSelection=function(t){var i=rangy.getSelection();if(0==i.isCollapsed&&i.rangeCount>0){if(t.stopPropagation(),n.popTip){if(t.target.classList.contains("poptip-action"))return;n.removePopTip()}var r=rangy.createClassApplier("temp-selection");r.applyToSelection();var o=e.getElementsByClassName("temp-selection")[0];n.buildPopupFromSelection(),n.popTip.style.top=o.offsetTop+o.offsetHeight+"px",n.popTip.style.left=o.offsetLeft+10+"px",n.element.appendChild(n.popTip),setTimeout(function(){window.addEventListener("resize",n.removePopTip),document.addEventListener("click",n.removePopTip)},50),r.undoToSelection()}},this.buildPopupFromSelection=function(){n.popTip=document.createElement("div"),n.popTip.className=n.settings.popTipClass,n.popTip.innerHTML="<a href='javascript:void(0);' class='poptip-action'>Add Highlight</a>",n.popTip.getElementsByClassName("poptip-action")[0].addEventListener("click",function(){refresh_submissions_list=!0,n.initializeHighlighter(),n.removePopTip()})},this.initializeHighlighter=function(){var e,t,i;if(e=rangy.getSelection(),0==e.isCollapsed&&e.rangeCount>0){i=e.getRangeAt(0),commonAncestor=i.commonAncestorContainer;for(var r=this.element||this;commonAncestor.dataset==undefined||commonAncestor.dataset[n.settings.nodeIdentifierKey]==undefined;)if(commonAncestor=commonAncestor.parentNode,commonAncestor==undefined||commonAncestor.contains(r))return;if(!((t=e.getBookmark(commonAncestor))&&t.rangeBookmarks.length>0))return;highlightParams={common_ancestor_node_type:commonAncestor.tagName,common_ancestor_identifier_key:n.settings.nodeIdentifierKey,common_ancestor_identifier:commonAncestor.dataset[n.settings.nodeIdentifierKey],start_offset:t.rangeBookmarks[0].start,end_offset:t.rangeBookmarks[0].end,backward:t.backward,content:e.toString()},n.saveContentHighlightsToServer(highlightParams),e.detach()}},this.getContentHighlightsFromServer=function(){this.saveContentHighlightsToServer({})},this.saveContentHighlightsToServer=function(e){n.ajaxLoader(n.settings.addToServerPath+n.sendToServerParams,e,function(e){n.modifyContentHighlights(e,"add")})},this.removeContentHighlightsFromServer=function(e){var t;if(e.className!=undefined)for(var i=e.className.split(" "),r=0;r<i.length;r++)i[r].substring(0,n.settings.highlightIdentifyClassRoot.length)==n.settings.highlightIdentifyClassRoot&&(t={content_highlight_id:i[r].substring(n.settings.highlightIdentifyClassRoot.length,i[r].length)});t!=undefined&&n.ajaxLoader(n.settings.removeFromServerPath+n.sendToServerParams,t,function(e){n.modifyContentHighlights(e,"remove")})},this.setEventListenersToHighlights=function(e){for(var t=0;t<e.length;t++)e[t].addEventListener("click",n.clickHighlightListener)},this.removeEventListenersFromHighlights=function(e){for(var t=0;t<e.length;t++)e[t].removeEventListener("click",n.clickHighlightListener)},this.clickHighlightListener=function(e){n.showPopTipFor(this,e),e.stopPropagation()},this.modifyContentHighlights=function(t,i){for(var r,o=rangy.getSelection(),a=0;a<t.length;a++)if(highlightableObject=t[a],containerNodes=e.querySelectorAll(highlightableObject.common_ancestor_node_type+"[data-"+n.settings.nodeIdentifierKey+'="'+highlightableObject.common_ancestor_identifier+'"]'),containerNodes.length>0)for(var s=0;s<containerNodes.length;s++)if(containerNode=containerNodes[s],bookmarkObject={backward:highlightableObject.backward,rangeBookmarks:[{start:highlightableObject.start_offset,end:highlightableObject.end_offset,containerNode:containerNode}]},r=rangy.createClassApplier(n.settings.highlightIdentifyClassRoot+highlightableObject.identifier,{elementProperties:{className:n.settings.highlightClass}}),o.moveToBookmark(bookmarkObject),o.toString()==highlightableObject.content)switch(i){case"add":r.applyToSelection();var l=e.getElementsByClassName(n.settings.highlightIdentifyClassRoot+highlightableObject.identifier);n.addDataAttributesToElements(l,[["description",highlightableObject.description],["removable",highlightableObject.can_cancel]]),highlightableObject.life_time_class_ends!=undefined&&n.addLifetimeClassesToElements(l,highlightableObject.life_time_class_ends),this.settings.readOnly||n.setEventListenersToHighlights(l);break;case"remove":var l=e.getElementsByClassName(n.settings.highlightIdentifyClassRoot+highlightableObject.identifier);n.removeDataAttributesFromElements(l,[["description",highlightableObject.description],["removable",highlightableObject.can_cancel]]),n.removeLifetimeClassesFromElements(l),n.removeEventListenersFromHighlights(l),n.unmarkActiveHighlights(),r.undoToSelection()}o.removeAllRanges(),o.detach()},this.addLifetimeClassesToElements=function(e,t){if(t.length>0)for(var i=0;i<e.length;i++){var r=e[i].className.split(" "),o=new Array;e:for(var a=0;a<t.length;a++){for(var s=0;s<r.length;s++)if(r[s]==n.settings.highlightLifetimeClassRoot+t[a])continue e;o.push(n.settings.highlightLifetimeClassRoot+t[a])}o.length>0&&(e[i].className=r.join(" ")+" "+o.join(" "))}},this.removeLifetimeClassesFromElements=function(e){for(var t=0;t<e.length;t++)if(e[t].className!=undefined){for(var i=e[t].className.split(" "),r=new Array,o=0;o<i.length;o++)i[o].substring(0,n.settings.highlightLifetimeClassRoot.length)!=n.settings.highlightLifetimeClassRoot&&r.push(i[o]);e[t].className=r.join(" ")}},this.addDataAttributesToElements=function(e,t){if(t.length>0)for(var n=0;n<e.length;n++)for(var i=0;i<t.length;i++)e[n].dataset[t[i][0]]=t[i][1]},this.removeDataAttributesFromElements=function(e,t){if(t.length>0)for(var n=0;n<e.length;n++)for(var i=0;i<t.length;i++)delete e[n].dataset[t[i][0]]},this.markHighlightAsActive=function(e){if(e.className!=undefined){for(var t=e.className.split(" "),i=0;i<t.length;i++)if(t[i]==n.settings.highlightActiveClass)return;t.push(n.settings.highlightActiveClass),e.className=t.join(" ")}},this.unmarkActiveHighlights=function(){for(var e=n.element.getElementsByClassName(n.settings.highlightActiveClass),t=0;t<e.length;t++)if(e[t].className!=undefined){for(var i=e[t].className.split(" "),r=new Array,o=0;o<i.length;o++)i[o]!=n.settings.highlightActiveClass&&r.push(i[o]);e[t].className=r.join(" ")}},this.showPopTipFor=function(e){n.removePopTip(),n.buildPopupFromHighlightElement(e),n.popTip!=undefined&&(n.popTip.style.top=e.offsetTop+e.offsetHeight+"px",n.popTip.style.left=e.offsetLeft+10+"px",n.element.appendChild(n.popTip),n.markHighlightAsActive(e),window.addEventListener("resize",n.removePopTip),document.addEventListener("click",n.removePopTip))},this.removePopTip=function(){n.popTip!=undefined&&(n.element.removeChild(n.popTip),n.popTip=undefined,n.unmarkActiveHighlights(),window.removeEventListener("resize",n.removePopTip),document.removeEventListener("click",n.removePopTip))},this.buildPopupFromHighlightElement=function(e){n.popTip=document.createElement("div"),n.popTip.className=n.settings.popTipClass,n.popTip.innerHTML="<span class='description'>"+(e.dataset.description||n.settings.popTipDefaultHead)+"</span>","true"==e.dataset.removable&&(n.popTip.innerHTML+="<a href='javascript:void(0);' class='poptip-action'>click to remove</a>",this.settings.showDiscussion&&(n.popTip.innerHTML+="<a href='javascript:void(0);' class='poptip-action'>discuss</a>",n.popTip.getElementsByClassName("poptip-action")[1]!=undefined&&n.popTip.getElementsByClassName("poptip-action")[1].addEventListener("click",function(){n.settings.showDiscussion(e)})),n.popTip.getElementsByClassName("poptip-action")[0]!=undefined&&n.popTip.getElementsByClassName("poptip-action")[0].addEventListener("click",function(){refresh_submissions_list=!0,n.removePopTip(),n.removeContentHighlightsFromServer(e)}))},this.ajaxLoader=function(e,t,i){var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.setRequestHeader("Accept","application/json"),null!=document.querySelector('meta[name="csrf-token"]')&&r.setRequestHeader("X-CSRF-Token",document.querySelector('meta[name="csrf-token"]').content),r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText);i(e)}},r.send(n.serializeParams(t))},this.serializeParams=function(e,t){var n,i=[];for(n in e)if(e.hasOwnProperty(n)){var r=t?t+"["+n+"]":n,o=e[n];i.push(null!==o&&"object"==typeof o?serialize(o,r):encodeURIComponent(r)+"="+encodeURIComponent(o))}return i.join("&")})};